<!DOCTYPE html>
<html lang="en"><head>
<script src="llm_thoughts_files/libs/clipboard/clipboard.min.js"></script>
<script src="llm_thoughts_files/libs/quarto-html/tabby.min.js"></script>
<script src="llm_thoughts_files/libs/quarto-html/popper.min.js"></script>
<script src="llm_thoughts_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="llm_thoughts_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="llm_thoughts_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="llm_thoughts_files/libs/quarto-html/quarto-syntax-highlighting-a126389619fad6dbfb296a5315d49fef.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="llm_thoughts_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="llm_thoughts_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="llm_thoughts_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.13">

  <meta name="author" content="胡悦">
  <meta name="dcterms.date" content="2025-06-23">
  <title>quarto-input18eb0182ed5d416f</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="llm_thoughts_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="llm_thoughts_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="llm_thoughts_files/libs/revealjs/dist/theme/quarto-4772a0f11472f0e84779a38f80adf547.css">
  <link rel="stylesheet" href="https://www.drhuyue.site/slides_gh/css/style_basic.css">
  <link href="llm_thoughts_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="llm_thoughts_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="llm_thoughts_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="llm_thoughts_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="https://gitlab.com/sammo3182/backup/raw/85b3c1ad4b459d7a9f901f124b936428eda5fcaf/logo_THPS.png?inline=true" data-background-position="top 10% right 5%" data-background-size="250px" class="quarto-title-block center">
  <h1 class="title"><div class="line-block">关于大语言模型时代<br>
自然语言分析使用一些想法</div></h1>
  <p class="subtitle">新闻传播学定量研究方法体系建设研讨会</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
胡悦 
</div>
        <p class="quarto-title-affiliation">
            清华大学社会科学学院
          </p>
    </div>
</div>

  <p class="date">2025-06-23</p>
</section>
<section id="问题" class="slide level2">
<h2>问题</h2>
<div style="text-align:center; margin-top: 1em">
<p>大语言模型时代，还需要（系统）学习（自然语言）研究方法吗？</p>
<ul>
<li>主体：<span class="red">研究者</span>还需要学吗？学生还需要学吗？</li>
<li>内容：要学NLP吗？要学<span class="red">统计</span>吗？要学编程吗？</li>
<li>方式：（非得要的话）<span class="red">什么时候</span>使用？怎么使用？</li>
</ul>
</div>
</section>
<section id="缘起" class="slide level2">
<h2>缘起</h2>
<div style="text-align:center">
<p><span class="red">纯</span>文科生上了“定量”的船</p>
</div>
<div class="columns">
<div class="column fragment" style="width:50%;">
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/text_democracy1991.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="@Hu2020a"><img data-src="https://drhuyue.site:10002/sammo3182/figure/text_democracy1991.png" class="quarto-figure quarto-figure-center" height="500" alt="Hu (2020)"></a></p>
</figure>
</div>
<figcaption><span class="citation" data-cites="Hu2020a">Hu (<a href="#/参考文献" role="doc-biblioref" onclick="">2020</a>)</span></figcaption>
</figure>
</div>
</div>
<aside class="notes">
<ul>
<li>由survey起家的研究进路</li>
<li>政治心理学 + 政治语言学</li>
<li>较早将STM引入中国政治学研究</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div><div class="column fragment" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/2023_rClass.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img data-src="https://drhuyue.site:10002/sammo3182/figure/2023_rClass.png" class="fragment quarto-figure quarto-figure-center" height="500"></a></p>
</figure>
</div>
<aside class="notes">
<ul>
<li>基础方法课程（概率论 → 回归）</li>
<li>大数据课程</li>
<li>编程工作坊</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div></div>
</section>
<section id="大语言模型来了" class="slide level2">
<h2>大语言模型来了……</h2>
<div class="overlay-container">
<div class="overlay-text">
<ul>
<li>前兆：“计算社会科学时代” → 词频分析落伍了</li>
<li>大语言模型：人类语言被破解 → 自然语言分析/“机器学习”落伍了</li>
</ul>
</div>
<div class="overlay-image fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/css_llmTree.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="@YangEtAl2024a"><img data-src="https://drhuyue.site:10002/sammo3182/figure/css_llmTree.jpg" class="quarto-figure quarto-figure-center" height="600" alt="Yang et al. (2024)"></a></p>
</figure>
</div>
<figcaption><span class="citation" data-cites="YangEtAl2024a">Yang et al. (<a href="#/参考文献" role="doc-biblioref" onclick="">2024</a>)</span></figcaption>
</figure>
</div>
</div>
<div class="overlay-text-over fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>与美国知名政治学教授、名校博士、大厂分析师的交流</strong></p>
</div>
<div class="callout-content">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li class="fragment"><em>我</em>：大语言模型时代，是不是不用学文本分析了？</li>
<li class="fragment"><em>专家</em>：能用大模型做的就用大模型吧。</li>
<li class="fragment"><em>我</em>：那学生们是不是也不用学习方法了吗？</li>
<li class="fragment"><em>专家</em>：就是用一下可以不学，要想深入研究的话，还是得学一些。</li>
<li class="fragment"><em>我</em>：“深入研究”什么？</li>
<li class="fragment"><em>专家</em>：理解方法应用的原理呀、正确使用啊之类的。</li>
<li class="fragment"><em>我</em>：不是可以问大语言模型么？而且给的答案越来越准确了。</li>
<li class="fragment"><em>专家</em>：确实。</li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li class="fragment"><em>我</em>：省下精力来，还可以多读理论、多看论文。</li>
<li class="fragment"><em>专家</em>：他们也不看啊……</li>
<li class="fragment"><em>我</em>：是不是连编程也不用学了？</li>
<li class="fragment"><em>专家</em>：现在LLM还不行，会出很多bug。</li>
<li class="fragment"><em>我</em>：跑不通可以再让LLM debug啊。而且，vibe coding在飞速发展呀！肯定会越来越准的。</li>
<li class="fragment"><em>专家</em>：确实，90%的程序都不是自己写的了。</li>
<li class="fragment"><em>我</em>：那我的编程培训班是不是可以不开了……</li>
<li class="fragment"><em>专家</em>：🙂（尴尬而又不失礼貌的微笑）</li>
</ul>
</div></div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="想法1学习主体" class="slide level2">
<h2>想法1：学习主体</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li class="fragment">学者还要不要关注方法：
<ul>
<li class="fragment">还是得关注</li>
<li class="fragment">还是得关注</li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li>从方法角度：弥补人力</li>
<li>从事业角度：培养学生</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div><div class="column" style="width:50%;">
<ul>
<li class="fragment">学生还要不要学习方法：
<ul>
<li class="fragment">系统学习</li>
<li class="fragment">能力训练</li>
<li class="fragment">权力关系</li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li>系统学习 vs.&nbsp;碎片化学习</li>
<li>能力训练 vs.&nbsp;知识积累</li>
<li>主动权在谁的手里</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div></div>
</section>
<section id="想法2学习内容" class="slide level2">
<h2>想法2：学习内容</h2>
<p>“最好像人一样读” <span class="fragment">&amp; “能跑就行”</span></p>
<aside class="notes">
<ul>
<li>语言的统计性规律</li>
<li>Function words</li>
<li>Linguistic psychology</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="r-stack fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="do">##说明</span></span>
<span id="cb1-2"><a href=""></a><span class="co">#8-170行属于爬取数据的环节</span></span>
<span id="cb1-3"><a href=""></a><span class="co">#180-321 搜索data scraping包及相关信息</span></span>
<span id="cb1-4"><a href=""></a><span class="co">#325-474 搜索data cleaning包及相关信息</span></span>
<span id="cb1-5"><a href=""></a><span class="co">#478-632 搜索data transformation包以及相关信息</span></span>
<span id="cb1-6"><a href=""></a></span>
<span id="cb1-7"><a href=""></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-8"><a href=""></a><span class="fu">library</span>(httr)</span>
<span id="cb1-9"><a href=""></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-10"><a href=""></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-11"><a href=""></a><span class="fu">library</span>(progress)</span>
<span id="cb1-12"><a href=""></a><span class="fu">library</span>(cli)</span>
<span id="cb1-13"><a href=""></a></span>
<span id="cb1-14"><a href=""></a>user_agent <span class="ot">&lt;-</span> <span class="st">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"</span></span>
<span id="cb1-15"><a href=""></a>delay_seconds <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb1-16"><a href=""></a></span>
<span id="cb1-17"><a href=""></a><span class="co"># 爬取所有R包的元信息</span></span>
<span id="cb1-18"><a href=""></a>scrape_cran_meta_descriptions <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">max_packages =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1-19"><a href=""></a>  <span class="co"># 获取包的链接</span></span>
<span id="cb1-20"><a href=""></a>  <span class="fu">cli_alert_info</span>(<span class="st">"正在获取CRAN包列表..."</span>)</span>
<span id="cb1-21"><a href=""></a>  main_url <span class="ot">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/available_packages_by_date.html"</span></span>
<span id="cb1-22"><a href=""></a></span>
<span id="cb1-23"><a href=""></a>  <span class="co"># 发送HTTP请求</span></span>
<span id="cb1-24"><a href=""></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(main_url, <span class="fu">user_agent</span>(user_agent))</span>
<span id="cb1-25"><a href=""></a>  <span class="cf">if</span> (<span class="fu">http_status</span>(response)<span class="sc">$</span>category <span class="sc">!=</span> <span class="st">"Success"</span>) {</span>
<span id="cb1-26"><a href=""></a>    <span class="fu">cli_alert_danger</span>(<span class="st">"无法获取主页面: {http_status(response)$message}"</span>)</span>
<span id="cb1-27"><a href=""></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb1-28"><a href=""></a>  }</span>
<span id="cb1-29"><a href=""></a></span>
<span id="cb1-30"><a href=""></a>  <span class="co"># 解析HTML内容</span></span>
<span id="cb1-31"><a href=""></a>  html_content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb1-32"><a href=""></a>  page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_content)</span>
<span id="cb1-33"><a href=""></a></span>
<span id="cb1-34"><a href=""></a>  <span class="co"># 提取表格中的所有行</span></span>
<span id="cb1-35"><a href=""></a>  rows <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">"table tr"</span>)</span>
<span id="cb1-36"><a href=""></a></span>
<span id="cb1-37"><a href=""></a>  <span class="co"># 提取包名和链接(跳过表头)</span></span>
<span id="cb1-38"><a href=""></a>  package_links <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(rows[<span class="sc">-</span><span class="dv">1</span>], <span class="cf">function</span>(row) {</span>
<span id="cb1-39"><a href=""></a>    cols <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(row, <span class="st">"td"</span>)</span>
<span id="cb1-40"><a href=""></a>    <span class="cf">if</span> (<span class="fu">length</span>(cols) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb1-41"><a href=""></a>      link <span class="ot">&lt;-</span> <span class="fu">html_node</span>(cols[<span class="dv">2</span>], <span class="st">"a"</span>)</span>
<span id="cb1-42"><a href=""></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(link)) {</span>
<span id="cb1-43"><a href=""></a>        href <span class="ot">&lt;-</span> <span class="fu">html_attr</span>(link, <span class="st">"href"</span>)</span>
<span id="cb1-44"><a href=""></a>        name <span class="ot">&lt;-</span> <span class="fu">html_text</span>(link) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-45"><a href=""></a></span>
<span id="cb1-46"><a href=""></a>        <span class="co"># 构建URL</span></span>
<span id="cb1-47"><a href=""></a>        full_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb1-48"><a href=""></a>          <span class="st">"https://cran.r-project.org"</span>,</span>
<span id="cb1-49"><a href=""></a>          <span class="fu">sub</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./(</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./)?"</span>, <span class="st">"/"</span>, href)</span>
<span id="cb1-50"><a href=""></a>        )</span>
<span id="cb1-51"><a href=""></a></span>
<span id="cb1-52"><a href=""></a>        <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb1-53"><a href=""></a>          <span class="at">package =</span> name,</span>
<span id="cb1-54"><a href=""></a>          <span class="at">url =</span> full_url,</span>
<span id="cb1-55"><a href=""></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-56"><a href=""></a>        ))</span>
<span id="cb1-57"><a href=""></a>      }</span>
<span id="cb1-58"><a href=""></a>    }</span>
<span id="cb1-59"><a href=""></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb1-60"><a href=""></a>  })</span>
<span id="cb1-61"><a href=""></a></span>
<span id="cb1-62"><a href=""></a>  <span class="co">#</span></span>
<span id="cb1-63"><a href=""></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(max_packages)) {</span>
<span id="cb1-64"><a href=""></a>    package_links <span class="ot">&lt;-</span> <span class="fu">head</span>(package_links, max_packages)</span>
<span id="cb1-65"><a href=""></a>    <span class="fu">cli_alert_info</span>(<span class="st">"测试模式：只爬取前 {max_packages} 个包"</span>)</span>
<span id="cb1-66"><a href=""></a>  }</span>
<span id="cb1-67"><a href=""></a></span>
<span id="cb1-68"><a href=""></a>  <span class="fu">cli_alert_success</span>(<span class="st">"准备爬取 {nrow(package_links)} 个R包的元描述信息"</span>)</span>
<span id="cb1-69"><a href=""></a></span>
<span id="cb1-70"><a href=""></a>  <span class="co"># 遍历每个包获取元信息</span></span>
<span id="cb1-71"><a href=""></a>  <span class="fu">cli_alert_info</span>(<span class="st">"开始爬取元描述信息..."</span>)</span>
<span id="cb1-72"><a href=""></a></span>
<span id="cb1-73"><a href=""></a>  <span class="co"># 创建进度条</span></span>
<span id="cb1-74"><a href=""></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb1-75"><a href=""></a>    <span class="at">format =</span> <span class="st">"[:bar] :percent | 已处理: :current / :total | 剩余: :eta"</span>,</span>
<span id="cb1-76"><a href=""></a>    <span class="at">total =</span> <span class="fu">nrow</span>(package_links),</span>
<span id="cb1-77"><a href=""></a>    <span class="at">clear =</span> <span class="cn">FALSE</span></span>
<span id="cb1-78"><a href=""></a>  )</span>
<span id="cb1-79"><a href=""></a></span>
<span id="cb1-80"><a href=""></a>  <span class="co"># 定义抓取单个包描述的函数</span></span>
<span id="cb1-81"><a href=""></a>  scrape_package_meta <span class="ot">&lt;-</span> <span class="cf">function</span>(url, package_name) {</span>
<span id="cb1-82"><a href=""></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb1-83"><a href=""></a>    <span class="fu">Sys.sleep</span>(delay_seconds)</span>
<span id="cb1-84"><a href=""></a></span>
<span id="cb1-85"><a href=""></a>    <span class="fu">tryCatch</span>(</span>
<span id="cb1-86"><a href=""></a>      {</span>
<span id="cb1-87"><a href=""></a>        <span class="co"># 发送HTTP请求</span></span>
<span id="cb1-88"><a href=""></a>        pkg_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="fu">user_agent</span>(user_agent))</span>
<span id="cb1-89"><a href=""></a>        <span class="cf">if</span> (<span class="fu">http_status</span>(pkg_response)<span class="sc">$</span>category <span class="sc">!=</span> <span class="st">"Success"</span>) {</span>
<span id="cb1-90"><a href=""></a>          <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb1-91"><a href=""></a>            <span class="at">package =</span> package_name,</span>
<span id="cb1-92"><a href=""></a>            <span class="at">meta_description =</span> <span class="fu">paste</span>(</span>
<span id="cb1-93"><a href=""></a>              <span class="st">"HTTP错误:"</span>,</span>
<span id="cb1-94"><a href=""></a>              <span class="fu">http_status</span>(pkg_response)<span class="sc">$</span>message</span>
<span id="cb1-95"><a href=""></a>            ),</span>
<span id="cb1-96"><a href=""></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-97"><a href=""></a>          ))</span>
<span id="cb1-98"><a href=""></a>        }</span>
<span id="cb1-99"><a href=""></a></span>
<span id="cb1-100"><a href=""></a>        <span class="co"># 解析HTML内容</span></span>
<span id="cb1-101"><a href=""></a>        pkg_html <span class="ot">&lt;-</span> <span class="fu">content</span>(pkg_response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb1-102"><a href=""></a>        pkg_page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(pkg_html)</span>
<span id="cb1-103"><a href=""></a></span>
<span id="cb1-104"><a href=""></a>        <span class="co"># 提取&lt;head&gt;中的&lt;meta property="og:description"&gt;内容</span></span>
<span id="cb1-105"><a href=""></a>        meta_description <span class="ot">&lt;-</span> pkg_page <span class="sc">%&gt;%</span></span>
<span id="cb1-106"><a href=""></a>          <span class="fu">html_node</span>(<span class="st">'head meta[property="og:description"]'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-107"><a href=""></a>          <span class="fu">html_attr</span>(<span class="st">"content"</span>)</span>
<span id="cb1-108"><a href=""></a></span>
<span id="cb1-109"><a href=""></a>        <span class="co"># 如果找到描述，进行清理</span></span>
<span id="cb1-110"><a href=""></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(meta_description)) {</span>
<span id="cb1-111"><a href=""></a>          <span class="co"># 清理HTML实体和多余空格</span></span>
<span id="cb1-112"><a href=""></a>          meta_description <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"&amp;amp;"</span>, <span class="st">"&amp;"</span>, meta_description)</span>
<span id="cb1-113"><a href=""></a>          meta_description <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"&amp;lt;"</span>, <span class="st">"&lt;"</span>, meta_description)</span>
<span id="cb1-114"><a href=""></a>          meta_description <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"&amp;gt;"</span>, <span class="st">"&gt;"</span>, meta_description)</span>
<span id="cb1-115"><a href=""></a>          meta_description <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">" "</span>, meta_description) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-116"><a href=""></a></span>
<span id="cb1-117"><a href=""></a>          <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb1-118"><a href=""></a>            <span class="at">package =</span> package_name,</span>
<span id="cb1-119"><a href=""></a>            <span class="at">meta_description =</span> meta_description,</span>
<span id="cb1-120"><a href=""></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-121"><a href=""></a>          ))</span>
<span id="cb1-122"><a href=""></a>        }</span>
<span id="cb1-123"><a href=""></a></span>
<span id="cb1-124"><a href=""></a>        <span class="co"># 如果找不到描述，尝试提取常规描述</span></span>
<span id="cb1-125"><a href=""></a>        <span class="fu">cli_alert_warning</span>(</span>
<span id="cb1-126"><a href=""></a>          <span class="st">"包 {package_name} 未找到og:description元标签，尝试提取常规描述"</span></span>
<span id="cb1-127"><a href=""></a>        )</span>
<span id="cb1-128"><a href=""></a></span>
<span id="cb1-129"><a href=""></a>        <span class="co"># 尝试从表格中提取描述</span></span>
<span id="cb1-130"><a href=""></a>        description_row <span class="ot">&lt;-</span> pkg_page <span class="sc">%&gt;%</span></span>
<span id="cb1-131"><a href=""></a>          <span class="fu">html_nodes</span>(<span class="st">"tr"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-132"><a href=""></a>          <span class="fu">keep</span>(<span class="sc">~</span> <span class="fu">html_text</span>(<span class="fu">html_node</span>(.x, <span class="st">"td:nth-child(1)"</span>)) <span class="sc">==</span> <span class="st">"Description:"</span>)</span>
<span id="cb1-133"><a href=""></a></span>
<span id="cb1-134"><a href=""></a>        <span class="cf">if</span> (<span class="fu">length</span>(description_row) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-135"><a href=""></a>          description <span class="ot">&lt;-</span> description_row[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb1-136"><a href=""></a>            <span class="fu">html_node</span>(<span class="st">"td:nth-child(2)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-137"><a href=""></a>            <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-138"><a href=""></a>            <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">" "</span>, .) <span class="sc">%&gt;%</span></span>
<span id="cb1-139"><a href=""></a>            <span class="fu">trimws</span>()</span>
<span id="cb1-140"><a href=""></a></span>
<span id="cb1-141"><a href=""></a>          <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb1-142"><a href=""></a>            <span class="at">package =</span> package_name,</span>
<span id="cb1-143"><a href=""></a>            <span class="at">meta_description =</span> description,</span>
<span id="cb1-144"><a href=""></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-145"><a href=""></a>          ))</span>
<span id="cb1-146"><a href=""></a>        }</span>
<span id="cb1-147"><a href=""></a></span>
<span id="cb1-148"><a href=""></a>        <span class="co"># 如果都找不到，返回未找到</span></span>
<span id="cb1-149"><a href=""></a>        <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb1-150"><a href=""></a>          <span class="at">package =</span> package_name,</span>
<span id="cb1-151"><a href=""></a>          <span class="at">meta_description =</span> <span class="st">"Description not found"</span>,</span>
<span id="cb1-152"><a href=""></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-153"><a href=""></a>        ))</span>
<span id="cb1-154"><a href=""></a>      },</span>
<span id="cb1-155"><a href=""></a>      <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-156"><a href=""></a>        <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb1-157"><a href=""></a>          <span class="at">package =</span> package_name,</span>
<span id="cb1-158"><a href=""></a>          <span class="at">meta_description =</span> <span class="fu">paste</span>(<span class="st">"错误:"</span>, <span class="fu">conditionMessage</span>(e)),</span>
<span id="cb1-159"><a href=""></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-160"><a href=""></a>        ))</span>
<span id="cb1-161"><a href=""></a>      }</span>
<span id="cb1-162"><a href=""></a>    )</span>
<span id="cb1-163"><a href=""></a>  }</span>
<span id="cb1-164"><a href=""></a></span>
<span id="cb1-165"><a href=""></a>  <span class="co"># 使用map安全地遍历所有包</span></span>
<span id="cb1-166"><a href=""></a>  results <span class="ot">&lt;-</span> <span class="fu">map2_dfr</span>(</span>
<span id="cb1-167"><a href=""></a>    package_links<span class="sc">$</span>url,</span>
<span id="cb1-168"><a href=""></a>    package_links<span class="sc">$</span>package,</span>
<span id="cb1-169"><a href=""></a>    scrape_package_meta</span>
<span id="cb1-170"><a href=""></a>  )</span>
<span id="cb1-171"><a href=""></a></span>
<span id="cb1-172"><a href=""></a>  <span class="co"># 统计结果</span></span>
<span id="cb1-173"><a href=""></a>  success_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(</span>
<span id="cb1-174"><a href=""></a>    results<span class="sc">$</span>meta_description <span class="sc">!=</span> <span class="st">"Description not found"</span> <span class="sc">&amp;</span></span>
<span id="cb1-175"><a href=""></a>      <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"错误:|HTTP错误"</span>, results<span class="sc">$</span>meta_description)</span>
<span id="cb1-176"><a href=""></a>  )</span>
<span id="cb1-177"><a href=""></a></span>
<span id="cb1-178"><a href=""></a>  <span class="fu">cli_alert_success</span>(<span class="st">"成功爬取 {success_count} 个包的元描述信息"</span>)</span>
<span id="cb1-179"><a href=""></a></span>
<span id="cb1-180"><a href=""></a>  <span class="co"># 保存结果到CSV</span></span>
<span id="cb1-181"><a href=""></a>  output_file <span class="ot">&lt;-</span> <span class="st">"cran_package_meta_descriptions.csv"</span></span>
<span id="cb1-182"><a href=""></a>  <span class="fu">write.csv</span>(results, output_file, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb1-183"><a href=""></a>  <span class="fu">cli_alert_success</span>(<span class="st">"结果已保存到: {output_file}"</span>)</span>
<span id="cb1-184"><a href=""></a></span>
<span id="cb1-185"><a href=""></a>  <span class="fu">return</span>(results)</span>
<span id="cb1-186"><a href=""></a>}</span>
<span id="cb1-187"><a href=""></a></span>
<span id="cb1-188"><a href=""></a></span>
<span id="cb1-189"><a href=""></a><span class="co"># test只爬取前5个包</span></span>
<span id="cb1-190"><a href=""></a>results_sample <span class="ot">&lt;-</span> <span class="fu">scrape_cran_meta_descriptions</span>(<span class="at">max_packages =</span> <span class="dv">5</span>)</span>
<span id="cb1-191"><a href=""></a></span>
<span id="cb1-192"><a href=""></a><span class="co"># 查看结果</span></span>
<span id="cb1-193"><a href=""></a><span class="fu">print</span>(results_sample)</span>
<span id="cb1-194"><a href=""></a></span>
<span id="cb1-195"><a href=""></a><span class="co"># 完整爬取</span></span>
<span id="cb1-196"><a href=""></a>all_results <span class="ot">&lt;-</span> <span class="fu">scrape_cran_meta_descriptions</span>()</span>
<span id="cb1-197"><a href=""></a></span>
<span id="cb1-198"><a href=""></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"cran_package_meta_descriptions.csv"</span>, <span class="at">nrows =</span> <span class="dv">100</span>)</span>
<span id="cb1-199"><a href=""></a><span class="fu">View</span>(data)</span>
<span id="cb1-200"><a href=""></a></span>
<span id="cb1-201"><a href=""></a><span class="fu">library</span>(readr)</span>
<span id="cb1-202"><a href=""></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"cran_package_meta_descriptions.csv"</span>)</span>
<span id="cb1-203"><a href=""></a></span>
<span id="cb1-204"><a href=""></a><span class="co">#分别匹配关键词</span></span>
<span id="cb1-205"><a href=""></a></span>
<span id="cb1-206"><a href=""></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-207"><a href=""></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-208"><a href=""></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-209"><a href=""></a></span>
<span id="cb1-210"><a href=""></a><span class="do">##data scraping</span></span>
<span id="cb1-211"><a href=""></a></span>
<span id="cb1-212"><a href=""></a>descriptions_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb1-213"><a href=""></a>  <span class="st">"cran_package_meta_descriptions.csv"</span>,</span>
<span id="cb1-214"><a href=""></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-215"><a href=""></a>  <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span></span>
<span id="cb1-216"><a href=""></a>)</span>
<span id="cb1-217"><a href=""></a><span class="do">###匹配关键词</span></span>
<span id="cb1-218"><a href=""></a>scraping_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-219"><a href=""></a>  <span class="st">"scrap"</span>,</span>
<span id="cb1-220"><a href=""></a>  <span class="st">"crawl"</span>,</span>
<span id="cb1-221"><a href=""></a>  <span class="st">"API"</span>,</span>
<span id="cb1-222"><a href=""></a>  <span class="st">"extract"</span>,</span>
<span id="cb1-223"><a href=""></a>  <span class="st">"harvest"</span>,</span>
<span id="cb1-224"><a href=""></a>  <span class="st">"gather"</span>,</span>
<span id="cb1-225"><a href=""></a>  <span class="st">"retrieve"</span>,</span>
<span id="cb1-226"><a href=""></a>  <span class="st">"collect"</span></span>
<span id="cb1-227"><a href=""></a>)</span>
<span id="cb1-228"><a href=""></a></span>
<span id="cb1-229"><a href=""></a><span class="do">###建立“或”关系</span></span>
<span id="cb1-230"><a href=""></a>pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b("</span>, <span class="fu">paste</span>(scraping_keywords, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")</span><span class="sc">\\</span><span class="st">b"</span>)</span>
<span id="cb1-231"><a href=""></a>pattern <span class="ot">&lt;-</span> <span class="fu">regex</span>(pattern, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-232"><a href=""></a></span>
<span id="cb1-233"><a href=""></a><span class="do">###筛选包含关键词的包</span></span>
<span id="cb1-234"><a href=""></a>scraping_packages <span class="ot">&lt;-</span> descriptions_df <span class="sc">%&gt;%</span></span>
<span id="cb1-235"><a href=""></a></span>
<span id="cb1-236"><a href=""></a>  <span class="fu">filter</span>(</span>
<span id="cb1-237"><a href=""></a>    <span class="sc">!</span><span class="fu">str_detect</span>(meta_description, <span class="st">"错误:|HTTP错误|Description not found"</span>)</span>
<span id="cb1-238"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-239"><a href=""></a></span>
<span id="cb1-240"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-241"><a href=""></a>    <span class="at">is_scraping =</span> <span class="fu">str_detect</span>(meta_description, pattern),</span>
<span id="cb1-242"><a href=""></a></span>
<span id="cb1-243"><a href=""></a>    <span class="at">matched_keywords =</span> <span class="fu">str_extract_all</span>(meta_description, pattern) <span class="sc">%&gt;%</span></span>
<span id="cb1-244"><a href=""></a>      <span class="fu">map_chr</span>(<span class="sc">~</span> <span class="fu">paste</span>(<span class="fu">unique</span>(.x), <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb1-245"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-246"><a href=""></a></span>
<span id="cb1-247"><a href=""></a>  <span class="fu">filter</span>(is_scraping) <span class="sc">%&gt;%</span></span>
<span id="cb1-248"><a href=""></a></span>
<span id="cb1-249"><a href=""></a>  <span class="fu">select</span>(package, meta_description, matched_keywords) <span class="sc">%&gt;%</span></span>
<span id="cb1-250"><a href=""></a></span>
<span id="cb1-251"><a href=""></a>  <span class="fu">arrange</span>(package)</span>
<span id="cb1-252"><a href=""></a></span>
<span id="cb1-253"><a href=""></a><span class="do">###打印前10</span></span>
<span id="cb1-254"><a href=""></a><span class="fu">head</span>(scraping_packages, <span class="dv">10</span>)</span>
<span id="cb1-255"><a href=""></a></span>
<span id="cb1-256"><a href=""></a><span class="fu">write.xlsx</span>(scraping_packages, <span class="st">"scraping_packages.xlsx"</span>)</span>
<span id="cb1-257"><a href=""></a></span>
<span id="cb1-258"><a href=""></a><span class="fu">cat</span>(<span class="st">"发现"</span>, <span class="fu">nrow</span>(scraping_packages), <span class="st">"个与数据抓取相关的R包</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-259"><a href=""></a></span>
<span id="cb1-260"><a href=""></a><span class="do">###添加包链接</span></span>
<span id="cb1-261"><a href=""></a>scraping_packages <span class="ot">&lt;-</span> scraping_packages <span class="sc">%&gt;%</span></span>
<span id="cb1-262"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-263"><a href=""></a>    <span class="at">cran_link =</span> <span class="fu">paste0</span>(</span>
<span id="cb1-264"><a href=""></a>      <span class="st">"https://cran.r-project.org/web/packages/"</span>,</span>
<span id="cb1-265"><a href=""></a>      package,</span>
<span id="cb1-266"><a href=""></a>      <span class="st">"/index.html"</span></span>
<span id="cb1-267"><a href=""></a>    )</span>
<span id="cb1-268"><a href=""></a>  )</span>
<span id="cb1-269"><a href=""></a></span>
<span id="cb1-270"><a href=""></a><span class="do">###保存带链接的结果</span></span>
<span id="cb1-271"><a href=""></a><span class="fu">write.xlsx</span>(scraping_packages, <span class="st">"data_scraping_packages_with_links.xlsx"</span>)</span>
<span id="cb1-272"><a href=""></a></span>
<span id="cb1-273"><a href=""></a><span class="do">###添加下载量信息</span></span>
<span id="cb1-274"><a href=""></a><span class="fu">library</span>(cranlogs)</span>
<span id="cb1-275"><a href=""></a></span>
<span id="cb1-276"><a href=""></a><span class="do">###分批处理50</span></span>
<span id="cb1-277"><a href=""></a>batch_size <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1-278"><a href=""></a>batches <span class="ot">&lt;-</span> <span class="fu">split</span>(</span>
<span id="cb1-279"><a href=""></a>  scraping_packages<span class="sc">$</span>package,</span>
<span id="cb1-280"><a href=""></a>  <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(scraping_packages<span class="sc">$</span>package) <span class="sc">/</span> batch_size)</span>
<span id="cb1-281"><a href=""></a>)</span>
<span id="cb1-282"><a href=""></a></span>
<span id="cb1-283"><a href=""></a>from_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">90</span></span>
<span id="cb1-284"><a href=""></a>to_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb1-285"><a href=""></a></span>
<span id="cb1-286"><a href=""></a></span>
<span id="cb1-287"><a href=""></a>download_stats_list <span class="ot">&lt;-</span> <span class="fu">map</span>(batches, <span class="cf">function</span>(batch) {</span>
<span id="cb1-288"><a href=""></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb1-289"><a href=""></a>  <span class="fu">cran_downloads</span>(</span>
<span id="cb1-290"><a href=""></a>    <span class="at">packages =</span> batch,</span>
<span id="cb1-291"><a href=""></a>    <span class="at">from =</span> from_date,</span>
<span id="cb1-292"><a href=""></a>    <span class="at">to =</span> to_date</span>
<span id="cb1-293"><a href=""></a>  )</span>
<span id="cb1-294"><a href=""></a>})</span>
<span id="cb1-295"><a href=""></a></span>
<span id="cb1-296"><a href=""></a><span class="do">###合并分批下载的数据</span></span>
<span id="cb1-297"><a href=""></a>download_stats <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(download_stats_list)</span>
<span id="cb1-298"><a href=""></a></span>
<span id="cb1-299"><a href=""></a>download_summary <span class="ot">&lt;-</span> download_stats <span class="sc">%&gt;%</span></span>
<span id="cb1-300"><a href=""></a>  <span class="fu">group_by</span>(package) <span class="sc">%&gt;%</span></span>
<span id="cb1-301"><a href=""></a>  <span class="fu">summarise</span>(<span class="at">total_downloads =</span> <span class="fu">sum</span>(count))</span>
<span id="cb1-302"><a href=""></a></span>
<span id="cb1-303"><a href=""></a>scraping_packages <span class="ot">&lt;-</span> scraping_packages <span class="sc">%&gt;%</span></span>
<span id="cb1-304"><a href=""></a>  <span class="fu">left_join</span>(download_summary, <span class="at">by =</span> <span class="st">"package"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-305"><a href=""></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_downloads))</span>
<span id="cb1-306"><a href=""></a></span>
<span id="cb1-307"><a href=""></a><span class="fu">print</span>(scraping_packages)</span>
<span id="cb1-308"><a href=""></a></span>
<span id="cb1-309"><a href=""></a><span class="fu">write.xlsx</span>(scraping_packages, <span class="st">"data_scraping_packages_with_links_rank.xlsx"</span>)</span>
<span id="cb1-310"><a href=""></a></span>
<span id="cb1-311"><a href=""></a><span class="do">###添加作者信息</span></span>
<span id="cb1-312"><a href=""></a></span>
<span id="cb1-313"><a href=""></a>get_authors_from_cran <span class="ot">&lt;-</span> <span class="cf">function</span>(package_name) {</span>
<span id="cb1-314"><a href=""></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb1-315"><a href=""></a>    {</span>
<span id="cb1-316"><a href=""></a>      <span class="do">###构建DESCRIPTION文件URL</span></span>
<span id="cb1-317"><a href=""></a>      desc_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb1-318"><a href=""></a>        <span class="st">"https://cran.r-project.org/web/packages/"</span>,</span>
<span id="cb1-319"><a href=""></a>        package_name,</span>
<span id="cb1-320"><a href=""></a>        <span class="st">"/DESCRIPTION"</span></span>
<span id="cb1-321"><a href=""></a>      )</span>
<span id="cb1-322"><a href=""></a></span>
<span id="cb1-323"><a href=""></a>      <span class="do">###发送HTTP请求</span></span>
<span id="cb1-324"><a href=""></a>      response <span class="ot">&lt;-</span> <span class="fu">GET</span>(desc_url, <span class="fu">user_agent</span>(<span class="st">"Mozilla/5.0"</span>))</span>
<span id="cb1-325"><a href=""></a>      <span class="cf">if</span> (<span class="fu">http_status</span>(response)<span class="sc">$</span>category <span class="sc">!=</span> <span class="st">"Success"</span>) {</span>
<span id="cb1-326"><a href=""></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> <span class="cn">NA</span>, <span class="at">maintainer =</span> <span class="cn">NA</span>))</span>
<span id="cb1-327"><a href=""></a>      }</span>
<span id="cb1-328"><a href=""></a></span>
<span id="cb1-329"><a href=""></a>      <span class="do">###解析DESCRIPTION内容</span></span>
<span id="cb1-330"><a href=""></a>      desc_content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb1-331"><a href=""></a></span>
<span id="cb1-332"><a href=""></a>      <span class="do">###提取作者和维护者信息</span></span>
<span id="cb1-333"><a href=""></a>      author <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"Author:"</span>, desc_content)) {</span>
<span id="cb1-334"><a href=""></a>        <span class="fu">sub</span>(<span class="st">".*Author:([^</span><span class="sc">\n</span><span class="st">]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, desc_content) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-335"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-336"><a href=""></a>        <span class="cn">NA_character_</span></span>
<span id="cb1-337"><a href=""></a>      }</span>
<span id="cb1-338"><a href=""></a></span>
<span id="cb1-339"><a href=""></a>      maintainer <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"Maintainer:"</span>, desc_content)) {</span>
<span id="cb1-340"><a href=""></a>        <span class="fu">sub</span>(<span class="st">".*Maintainer:([^</span><span class="sc">\n</span><span class="st">]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, desc_content) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-341"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-342"><a href=""></a>        <span class="cn">NA_character_</span></span>
<span id="cb1-343"><a href=""></a>      }</span>
<span id="cb1-344"><a href=""></a></span>
<span id="cb1-345"><a href=""></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> author, <span class="at">maintainer =</span> maintainer))</span>
<span id="cb1-346"><a href=""></a>    },</span>
<span id="cb1-347"><a href=""></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-348"><a href=""></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> <span class="cn">NA</span>, <span class="at">maintainer =</span> <span class="cn">NA</span>))</span>
<span id="cb1-349"><a href=""></a>    }</span>
<span id="cb1-350"><a href=""></a>  )</span>
<span id="cb1-351"><a href=""></a>}</span>
<span id="cb1-352"><a href=""></a></span>
<span id="cb1-353"><a href=""></a><span class="do">###为每个包获取作者信息</span></span>
<span id="cb1-354"><a href=""></a><span class="cf">if</span> (</span>
<span id="cb1-355"><a href=""></a>  <span class="sc">!</span><span class="st">"author"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(scraping_packages) <span class="sc">||</span></span>
<span id="cb1-356"><a href=""></a>    <span class="fu">all</span>(<span class="fu">is.na</span>(scraping_packages<span class="sc">$</span>author))</span>
<span id="cb1-357"><a href=""></a>) {</span>
<span id="cb1-358"><a href=""></a>  <span class="do">###创建进度条</span></span>
<span id="cb1-359"><a href=""></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb1-360"><a href=""></a>    <span class="at">format =</span> <span class="st">"获取作者信息 [:bar] :percent | 已处理: :current / :total | 剩余: :eta"</span>,</span>
<span id="cb1-361"><a href=""></a>    <span class="at">total =</span> <span class="fu">nrow</span>(scraping_packages),</span>
<span id="cb1-362"><a href=""></a>    <span class="at">clear =</span> <span class="cn">FALSE</span></span>
<span id="cb1-363"><a href=""></a>  )</span>
<span id="cb1-364"><a href=""></a></span>
<span id="cb1-365"><a href=""></a>  <span class="do">###获取作者信息</span></span>
<span id="cb1-366"><a href=""></a>  author_info <span class="ot">&lt;-</span> <span class="fu">map</span>(scraping_packages<span class="sc">$</span>package, <span class="cf">function</span>(pkg) {</span>
<span id="cb1-367"><a href=""></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb1-368"><a href=""></a>    <span class="fu">Sys.sleep</span>(<span class="fl">0.3</span>) <span class="co"># 礼貌性延时</span></span>
<span id="cb1-369"><a href=""></a>    <span class="fu">get_authors_from_cran</span>(pkg)</span>
<span id="cb1-370"><a href=""></a>  })</span>
<span id="cb1-371"><a href=""></a></span>
<span id="cb1-372"><a href=""></a>  <span class="do">###添加作者信息到数据框</span></span>
<span id="cb1-373"><a href=""></a>  scraping_packages<span class="sc">$</span>author <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(author_info, <span class="sc">~</span> .x<span class="sc">$</span>author)</span>
<span id="cb1-374"><a href=""></a>  scraping_packages<span class="sc">$</span>maintainer <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(author_info, <span class="sc">~</span> .x<span class="sc">$</span>maintainer)</span>
<span id="cb1-375"><a href=""></a>}</span>
<span id="cb1-376"><a href=""></a></span>
<span id="cb1-377"><a href=""></a><span class="fu">write.xlsx</span>(scraping_packages, <span class="st">"data_scraping_packages_final.xlsx"</span>)</span>
<span id="cb1-378"><a href=""></a></span>
<span id="cb1-379"><a href=""></a><span class="do">##data cleaing</span></span>
<span id="cb1-380"><a href=""></a></span>
<span id="cb1-381"><a href=""></a><span class="co">#读取已爬取的数据</span></span>
<span id="cb1-382"><a href=""></a>descriptions_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb1-383"><a href=""></a>  <span class="st">"cran_package_meta_descriptions.csv"</span>,</span>
<span id="cb1-384"><a href=""></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-385"><a href=""></a>  <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span></span>
<span id="cb1-386"><a href=""></a>)</span>
<span id="cb1-387"><a href=""></a></span>
<span id="cb1-388"><a href=""></a><span class="co"># 定义关键词列表</span></span>
<span id="cb1-389"><a href=""></a>cleaning_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-390"><a href=""></a>  <span class="st">"clean"</span>,</span>
<span id="cb1-391"><a href=""></a>  <span class="st">"preprocess"</span>,</span>
<span id="cb1-392"><a href=""></a>  <span class="st">"sanitize"</span>,</span>
<span id="cb1-393"><a href=""></a>  <span class="st">"scrub"</span>,</span>
<span id="cb1-394"><a href=""></a>  <span class="st">"correct"</span>,</span>
<span id="cb1-395"><a href=""></a>  <span class="st">"rectify"</span></span>
<span id="cb1-396"><a href=""></a>)</span>
<span id="cb1-397"><a href=""></a></span>
<span id="cb1-398"><a href=""></a><span class="co"># 检查并移除空元素</span></span>
<span id="cb1-399"><a href=""></a>cleaning_keywords <span class="ot">&lt;-</span> cleaning_keywords[<span class="fu">nchar</span>(cleaning_keywords) <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb1-400"><a href=""></a></span>
<span id="cb1-401"><a href=""></a><span class="co">#创建“或”关系</span></span>
<span id="cb1-402"><a href=""></a>pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b("</span>, <span class="fu">paste</span>(cleaning_keywords, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")</span><span class="sc">\\</span><span class="st">b"</span>)</span>
<span id="cb1-403"><a href=""></a>pattern <span class="ot">&lt;-</span> <span class="fu">regex</span>(pattern, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-404"><a href=""></a></span>
<span id="cb1-405"><a href=""></a><span class="co"># 筛选包含关键词的包</span></span>
<span id="cb1-406"><a href=""></a>cleaning_packages <span class="ot">&lt;-</span> descriptions_df <span class="sc">%&gt;%</span></span>
<span id="cb1-407"><a href=""></a>  <span class="co"># 过滤掉错误和未找到的描述</span></span>
<span id="cb1-408"><a href=""></a>  <span class="fu">filter</span>(</span>
<span id="cb1-409"><a href=""></a>    <span class="sc">!</span><span class="fu">str_detect</span>(meta_description, <span class="st">"错误:|HTTP错误|Description not found"</span>)</span>
<span id="cb1-410"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-411"><a href=""></a>  <span class="co"># 添加新列标记是否匹配关键词</span></span>
<span id="cb1-412"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-413"><a href=""></a>    <span class="at">is_cleaning =</span> <span class="fu">str_detect</span>(meta_description, pattern),</span>
<span id="cb1-414"><a href=""></a>    <span class="co"># 提取匹配的关键词</span></span>
<span id="cb1-415"><a href=""></a>    <span class="at">matched_keywords =</span> <span class="fu">sapply</span>(meta_description, <span class="cf">function</span>(desc) {</span>
<span id="cb1-416"><a href=""></a>      matches <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(desc, pattern)[[<span class="dv">1</span>]]</span>
<span id="cb1-417"><a href=""></a>      <span class="cf">if</span> (<span class="fu">length</span>(matches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-418"><a href=""></a>        <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">tolower</span>(matches)), <span class="at">collapse =</span> <span class="st">", "</span>) <span class="co"># 转换为小写并去重</span></span>
<span id="cb1-419"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-420"><a href=""></a>        <span class="st">""</span></span>
<span id="cb1-421"><a href=""></a>      }</span>
<span id="cb1-422"><a href=""></a>    })</span>
<span id="cb1-423"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-424"><a href=""></a>  <span class="co"># 只保留匹配的包</span></span>
<span id="cb1-425"><a href=""></a>  <span class="fu">filter</span>(is_cleaning) <span class="sc">%&gt;%</span></span>
<span id="cb1-426"><a href=""></a>  <span class="co"># 选择需要的列</span></span>
<span id="cb1-427"><a href=""></a>  <span class="fu">select</span>(package, meta_description, matched_keywords) <span class="sc">%&gt;%</span></span>
<span id="cb1-428"><a href=""></a>  <span class="co"># 按包名排序</span></span>
<span id="cb1-429"><a href=""></a>  <span class="fu">arrange</span>(package)</span>
<span id="cb1-430"><a href=""></a></span>
<span id="cb1-431"><a href=""></a><span class="co"># 显示前10</span></span>
<span id="cb1-432"><a href=""></a><span class="fu">head</span>(cleaning_packages, <span class="dv">10</span>)</span>
<span id="cb1-433"><a href=""></a></span>
<span id="cb1-434"><a href=""></a><span class="co"># 输出结果到Excel文件</span></span>
<span id="cb1-435"><a href=""></a><span class="fu">write.xlsx</span>(cleaning_packages, <span class="st">"data_cleaning_packages.xlsx"</span>)</span>
<span id="cb1-436"><a href=""></a></span>
<span id="cb1-437"><a href=""></a><span class="co"># 添加包链接</span></span>
<span id="cb1-438"><a href=""></a>cleaning_packages <span class="ot">&lt;-</span> cleaning_packages <span class="sc">%&gt;%</span></span>
<span id="cb1-439"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-440"><a href=""></a>    <span class="at">cran_link =</span> <span class="fu">paste0</span>(</span>
<span id="cb1-441"><a href=""></a>      <span class="st">"https://cran.r-project.org/web/packages/"</span>,</span>
<span id="cb1-442"><a href=""></a>      package,</span>
<span id="cb1-443"><a href=""></a>      <span class="st">"/index.html"</span></span>
<span id="cb1-444"><a href=""></a>    )</span>
<span id="cb1-445"><a href=""></a>  )</span>
<span id="cb1-446"><a href=""></a></span>
<span id="cb1-447"><a href=""></a><span class="co"># 保存结果</span></span>
<span id="cb1-448"><a href=""></a><span class="fu">write.xlsx</span>(cleaning_packages, <span class="st">"data_cleaning_packages_with_links.xlsx"</span>)</span>
<span id="cb1-449"><a href=""></a></span>
<span id="cb1-450"><a href=""></a></span>
<span id="cb1-451"><a href=""></a><span class="co"># 分批次处理包</span></span>
<span id="cb1-452"><a href=""></a>batch_size <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1-453"><a href=""></a>batches <span class="ot">&lt;-</span> <span class="fu">split</span>(</span>
<span id="cb1-454"><a href=""></a>  cleaning_packages<span class="sc">$</span>package,</span>
<span id="cb1-455"><a href=""></a>  <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(cleaning_packages<span class="sc">$</span>package) <span class="sc">/</span> batch_size)</span>
<span id="cb1-456"><a href=""></a>)</span>
<span id="cb1-457"><a href=""></a></span>
<span id="cb1-458"><a href=""></a>from_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">90</span></span>
<span id="cb1-459"><a href=""></a>to_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb1-460"><a href=""></a></span>
<span id="cb1-461"><a href=""></a><span class="co"># 分批获取下载量</span></span>
<span id="cb1-462"><a href=""></a>download_stats_list <span class="ot">&lt;-</span> <span class="fu">map</span>(batches, <span class="cf">function</span>(batch) {</span>
<span id="cb1-463"><a href=""></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb1-464"><a href=""></a>  <span class="fu">cran_downloads</span>(</span>
<span id="cb1-465"><a href=""></a>    <span class="at">packages =</span> batch,</span>
<span id="cb1-466"><a href=""></a>    <span class="at">from =</span> from_date,</span>
<span id="cb1-467"><a href=""></a>    <span class="at">to =</span> to_date</span>
<span id="cb1-468"><a href=""></a>  )</span>
<span id="cb1-469"><a href=""></a>})</span>
<span id="cb1-470"><a href=""></a></span>
<span id="cb1-471"><a href=""></a><span class="co"># 合并所有批次的结果</span></span>
<span id="cb1-472"><a href=""></a>download_stats <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(download_stats_list)</span>
<span id="cb1-473"><a href=""></a></span>
<span id="cb1-474"><a href=""></a>download_summary <span class="ot">&lt;-</span> download_stats <span class="sc">%&gt;%</span></span>
<span id="cb1-475"><a href=""></a>  <span class="fu">group_by</span>(package) <span class="sc">%&gt;%</span></span>
<span id="cb1-476"><a href=""></a>  <span class="fu">summarise</span>(<span class="at">total_downloads =</span> <span class="fu">sum</span>(count))</span>
<span id="cb1-477"><a href=""></a></span>
<span id="cb1-478"><a href=""></a>cleaning_packages <span class="ot">&lt;-</span> cleaning_packages <span class="sc">%&gt;%</span></span>
<span id="cb1-479"><a href=""></a>  <span class="fu">left_join</span>(download_summary, <span class="at">by =</span> <span class="st">"package"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-480"><a href=""></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_downloads))</span>
<span id="cb1-481"><a href=""></a></span>
<span id="cb1-482"><a href=""></a></span>
<span id="cb1-483"><a href=""></a><span class="fu">write.xlsx</span>(cleaning_packages, <span class="st">"data_cleaning_packages_with_links_rank.xlsx"</span>)</span>
<span id="cb1-484"><a href=""></a></span>
<span id="cb1-485"><a href=""></a><span class="co"># 添加作者信息</span></span>
<span id="cb1-486"><a href=""></a></span>
<span id="cb1-487"><a href=""></a>get_authors_from_cran <span class="ot">&lt;-</span> <span class="cf">function</span>(package_name) {</span>
<span id="cb1-488"><a href=""></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb1-489"><a href=""></a>    {</span>
<span id="cb1-490"><a href=""></a>      <span class="co"># 构建DESCRIPTION文件URL</span></span>
<span id="cb1-491"><a href=""></a>      desc_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb1-492"><a href=""></a>        <span class="st">"https://cran.r-project.org/web/packages/"</span>,</span>
<span id="cb1-493"><a href=""></a>        package_name,</span>
<span id="cb1-494"><a href=""></a>        <span class="st">"/DESCRIPTION"</span></span>
<span id="cb1-495"><a href=""></a>      )</span>
<span id="cb1-496"><a href=""></a></span>
<span id="cb1-497"><a href=""></a>      <span class="co"># 发送HTTP请求</span></span>
<span id="cb1-498"><a href=""></a>      response <span class="ot">&lt;-</span> <span class="fu">GET</span>(desc_url, <span class="fu">user_agent</span>(<span class="st">"Mozilla/5.0"</span>))</span>
<span id="cb1-499"><a href=""></a>      <span class="cf">if</span> (<span class="fu">http_status</span>(response)<span class="sc">$</span>category <span class="sc">!=</span> <span class="st">"Success"</span>) {</span>
<span id="cb1-500"><a href=""></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> <span class="cn">NA</span>, <span class="at">maintainer =</span> <span class="cn">NA</span>))</span>
<span id="cb1-501"><a href=""></a>      }</span>
<span id="cb1-502"><a href=""></a></span>
<span id="cb1-503"><a href=""></a>      <span class="co"># 解析DESCRIPTION内容</span></span>
<span id="cb1-504"><a href=""></a>      desc_content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb1-505"><a href=""></a></span>
<span id="cb1-506"><a href=""></a>      <span class="co"># 提取作者和维护者信息</span></span>
<span id="cb1-507"><a href=""></a>      author <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"Author:"</span>, desc_content)) {</span>
<span id="cb1-508"><a href=""></a>        <span class="fu">sub</span>(<span class="st">".*Author:([^</span><span class="sc">\n</span><span class="st">]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, desc_content) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-509"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-510"><a href=""></a>        <span class="cn">NA_character_</span></span>
<span id="cb1-511"><a href=""></a>      }</span>
<span id="cb1-512"><a href=""></a></span>
<span id="cb1-513"><a href=""></a>      maintainer <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"Maintainer:"</span>, desc_content)) {</span>
<span id="cb1-514"><a href=""></a>        <span class="fu">sub</span>(<span class="st">".*Maintainer:([^</span><span class="sc">\n</span><span class="st">]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, desc_content) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-515"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-516"><a href=""></a>        <span class="cn">NA_character_</span></span>
<span id="cb1-517"><a href=""></a>      }</span>
<span id="cb1-518"><a href=""></a></span>
<span id="cb1-519"><a href=""></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> author, <span class="at">maintainer =</span> maintainer))</span>
<span id="cb1-520"><a href=""></a>    },</span>
<span id="cb1-521"><a href=""></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-522"><a href=""></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> <span class="cn">NA</span>, <span class="at">maintainer =</span> <span class="cn">NA</span>))</span>
<span id="cb1-523"><a href=""></a>    }</span>
<span id="cb1-524"><a href=""></a>  )</span>
<span id="cb1-525"><a href=""></a>}</span>
<span id="cb1-526"><a href=""></a></span>
<span id="cb1-527"><a href=""></a><span class="co"># 为每个包获取作者信息</span></span>
<span id="cb1-528"><a href=""></a><span class="cf">if</span> (</span>
<span id="cb1-529"><a href=""></a>  <span class="sc">!</span><span class="st">"author"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cleaning_packages) <span class="sc">||</span></span>
<span id="cb1-530"><a href=""></a>    <span class="fu">all</span>(<span class="fu">is.na</span>(cleaning_packages<span class="sc">$</span>author))</span>
<span id="cb1-531"><a href=""></a>) {</span>
<span id="cb1-532"><a href=""></a>  <span class="co"># 创建进度条</span></span>
<span id="cb1-533"><a href=""></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb1-534"><a href=""></a>    <span class="at">format =</span> <span class="st">"获取作者信息 [:bar] :percent | 已处理: :current / :total | 剩余: :eta"</span>,</span>
<span id="cb1-535"><a href=""></a>    <span class="at">total =</span> <span class="fu">nrow</span>(cleaning_packages),</span>
<span id="cb1-536"><a href=""></a>    <span class="at">clear =</span> <span class="cn">FALSE</span></span>
<span id="cb1-537"><a href=""></a>  )</span>
<span id="cb1-538"><a href=""></a></span>
<span id="cb1-539"><a href=""></a>  <span class="co"># 获取作者信息</span></span>
<span id="cb1-540"><a href=""></a>  author_info <span class="ot">&lt;-</span> <span class="fu">map</span>(cleaning_packages<span class="sc">$</span>package, <span class="cf">function</span>(pkg) {</span>
<span id="cb1-541"><a href=""></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb1-542"><a href=""></a>    <span class="fu">Sys.sleep</span>(<span class="fl">0.3</span>) <span class="co"># 礼貌性延时</span></span>
<span id="cb1-543"><a href=""></a>    <span class="fu">get_authors_from_cran</span>(pkg)</span>
<span id="cb1-544"><a href=""></a>  })</span>
<span id="cb1-545"><a href=""></a></span>
<span id="cb1-546"><a href=""></a>  <span class="co"># 添加作者信息到数据框</span></span>
<span id="cb1-547"><a href=""></a>  cleaning_packages<span class="sc">$</span>author <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(author_info, <span class="sc">~</span> .x<span class="sc">$</span>author)</span>
<span id="cb1-548"><a href=""></a>  cleaning_packages<span class="sc">$</span>maintainer <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(author_info, <span class="sc">~</span> .x<span class="sc">$</span>maintainer)</span>
<span id="cb1-549"><a href=""></a>}</span>
<span id="cb1-550"><a href=""></a></span>
<span id="cb1-551"><a href=""></a><span class="co"># 保存最终结果</span></span>
<span id="cb1-552"><a href=""></a><span class="fu">write.xlsx</span>(cleaning_packages, <span class="st">"data_cleaning_packages_final.xlsx"</span>)</span>
<span id="cb1-553"><a href=""></a></span>
<span id="cb1-554"><a href=""></a><span class="do">##data transformation</span></span>
<span id="cb1-555"><a href=""></a></span>
<span id="cb1-556"><a href=""></a>descriptions_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb1-557"><a href=""></a>  <span class="st">"cran_package_meta_descriptions.csv"</span>,</span>
<span id="cb1-558"><a href=""></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-559"><a href=""></a>  <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span></span>
<span id="cb1-560"><a href=""></a>)</span>
<span id="cb1-561"><a href=""></a></span>
<span id="cb1-562"><a href=""></a><span class="co"># 关键词列表</span></span>
<span id="cb1-563"><a href=""></a>transformation_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-564"><a href=""></a>  <span class="st">"transform"</span>,</span>
<span id="cb1-565"><a href=""></a>  <span class="st">"reshape"</span>,</span>
<span id="cb1-566"><a href=""></a>  <span class="st">"recode"</span>,</span>
<span id="cb1-567"><a href=""></a>  <span class="st">"convert"</span>,</span>
<span id="cb1-568"><a href=""></a>  <span class="st">"compute"</span>,</span>
<span id="cb1-569"><a href=""></a>  <span class="st">"derive"</span>,</span>
<span id="cb1-570"><a href=""></a>  <span class="st">"mutate"</span>,</span>
<span id="cb1-571"><a href=""></a>  <span class="st">"modify"</span>,</span>
<span id="cb1-572"><a href=""></a>  <span class="st">"reformat"</span>,</span>
<span id="cb1-573"><a href=""></a>  <span class="st">"restructure"</span>,</span>
<span id="cb1-574"><a href=""></a>  <span class="st">"aggregate"</span></span>
<span id="cb1-575"><a href=""></a>)</span>
<span id="cb1-576"><a href=""></a></span>
<span id="cb1-577"><a href=""></a><span class="co"># 检查并移除空元素</span></span>
<span id="cb1-578"><a href=""></a>transformation_keywords <span class="ot">&lt;-</span> transformation_keywords[</span>
<span id="cb1-579"><a href=""></a>  <span class="fu">nchar</span>(transformation_keywords) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb1-580"><a href=""></a>]</span>
<span id="cb1-581"><a href=""></a></span>
<span id="cb1-582"><a href=""></a><span class="co"># 创建正则表达式</span></span>
<span id="cb1-583"><a href=""></a>pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb1-584"><a href=""></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">b("</span>,</span>
<span id="cb1-585"><a href=""></a>  <span class="fu">paste</span>(transformation_keywords, <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb1-586"><a href=""></a>  <span class="st">")</span><span class="sc">\\</span><span class="st">b"</span></span>
<span id="cb1-587"><a href=""></a>)</span>
<span id="cb1-588"><a href=""></a>pattern <span class="ot">&lt;-</span> <span class="fu">regex</span>(pattern, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-589"><a href=""></a></span>
<span id="cb1-590"><a href=""></a><span class="co"># 筛选包含关键词的包</span></span>
<span id="cb1-591"><a href=""></a>transformation_packages <span class="ot">&lt;-</span> descriptions_df <span class="sc">%&gt;%</span></span>
<span id="cb1-592"><a href=""></a>  <span class="co"># 过滤掉错误和未找到的描述</span></span>
<span id="cb1-593"><a href=""></a>  <span class="fu">filter</span>(</span>
<span id="cb1-594"><a href=""></a>    <span class="sc">!</span><span class="fu">str_detect</span>(meta_description, <span class="st">"错误:|HTTP错误|Description not found"</span>)</span>
<span id="cb1-595"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-596"><a href=""></a>  <span class="co"># 添加新列标记是否匹配关键词</span></span>
<span id="cb1-597"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-598"><a href=""></a>    <span class="at">is_transformation =</span> <span class="fu">str_detect</span>(meta_description, pattern),</span>
<span id="cb1-599"><a href=""></a>    <span class="co"># 提取匹配的关键词</span></span>
<span id="cb1-600"><a href=""></a>    <span class="at">matched_keywords =</span> <span class="fu">sapply</span>(meta_description, <span class="cf">function</span>(desc) {</span>
<span id="cb1-601"><a href=""></a>      matches <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(desc, pattern)[[<span class="dv">1</span>]]</span>
<span id="cb1-602"><a href=""></a>      <span class="cf">if</span> (<span class="fu">length</span>(matches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-603"><a href=""></a>        <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">tolower</span>(matches)), <span class="at">collapse =</span> <span class="st">", "</span>) <span class="co"># 转换为小写并去重</span></span>
<span id="cb1-604"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-605"><a href=""></a>        <span class="st">""</span></span>
<span id="cb1-606"><a href=""></a>      }</span>
<span id="cb1-607"><a href=""></a>    })</span>
<span id="cb1-608"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-609"><a href=""></a>  <span class="co"># 只保留匹配的包</span></span>
<span id="cb1-610"><a href=""></a>  <span class="fu">filter</span>(is_transformation) <span class="sc">%&gt;%</span></span>
<span id="cb1-611"><a href=""></a>  <span class="co"># 选择需要的列</span></span>
<span id="cb1-612"><a href=""></a>  <span class="fu">select</span>(package, meta_description, matched_keywords) <span class="sc">%&gt;%</span></span>
<span id="cb1-613"><a href=""></a>  <span class="co"># 按包名排序</span></span>
<span id="cb1-614"><a href=""></a>  <span class="fu">arrange</span>(package)</span>
<span id="cb1-615"><a href=""></a></span>
<span id="cb1-616"><a href=""></a><span class="co"># 显示前10</span></span>
<span id="cb1-617"><a href=""></a><span class="fu">head</span>(transformation_packages, <span class="dv">10</span>)</span>
<span id="cb1-618"><a href=""></a></span>
<span id="cb1-619"><a href=""></a><span class="co"># 输出结果</span></span>
<span id="cb1-620"><a href=""></a><span class="fu">write.xlsx</span>(transformation_packages, <span class="st">"data_transformation_packages.xlsx"</span>)</span>
<span id="cb1-621"><a href=""></a></span>
<span id="cb1-622"><a href=""></a><span class="co"># 统计结果</span></span>
<span id="cb1-623"><a href=""></a><span class="fu">cat</span>(<span class="st">"发现"</span>, <span class="fu">nrow</span>(transformation_packages), <span class="st">"个与数据转换相关的R包</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-624"><a href=""></a></span>
<span id="cb1-625"><a href=""></a><span class="co"># 添加包链接</span></span>
<span id="cb1-626"><a href=""></a>transformation_packages <span class="ot">&lt;-</span> transformation_packages <span class="sc">%&gt;%</span></span>
<span id="cb1-627"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-628"><a href=""></a>    <span class="at">cran_link =</span> <span class="fu">paste0</span>(</span>
<span id="cb1-629"><a href=""></a>      <span class="st">"https://cran.r-project.org/web/packages/"</span>,</span>
<span id="cb1-630"><a href=""></a>      package,</span>
<span id="cb1-631"><a href=""></a>      <span class="st">"/index.html"</span></span>
<span id="cb1-632"><a href=""></a>    )</span>
<span id="cb1-633"><a href=""></a>  )</span>
<span id="cb1-634"><a href=""></a></span>
<span id="cb1-635"><a href=""></a><span class="co"># 保存结果</span></span>
<span id="cb1-636"><a href=""></a><span class="fu">write.xlsx</span>(</span>
<span id="cb1-637"><a href=""></a>  transformation_packages,</span>
<span id="cb1-638"><a href=""></a>  <span class="st">"data_transformation_packages_with_links.xlsx"</span></span>
<span id="cb1-639"><a href=""></a>)</span>
<span id="cb1-640"><a href=""></a></span>
<span id="cb1-641"><a href=""></a></span>
<span id="cb1-642"><a href=""></a><span class="co"># 将包列表分成较小的批次</span></span>
<span id="cb1-643"><a href=""></a>batch_size <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1-644"><a href=""></a>batches <span class="ot">&lt;-</span> <span class="fu">split</span>(</span>
<span id="cb1-645"><a href=""></a>  transformation_packages<span class="sc">$</span>package,</span>
<span id="cb1-646"><a href=""></a>  <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(transformation_packages<span class="sc">$</span>package) <span class="sc">/</span> batch_size)</span>
<span id="cb1-647"><a href=""></a>)</span>
<span id="cb1-648"><a href=""></a></span>
<span id="cb1-649"><a href=""></a><span class="co"># 设置时间范围</span></span>
<span id="cb1-650"><a href=""></a>from_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">90</span></span>
<span id="cb1-651"><a href=""></a>to_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb1-652"><a href=""></a></span>
<span id="cb1-653"><a href=""></a><span class="co"># 分批获取下载量</span></span>
<span id="cb1-654"><a href=""></a>download_stats_list <span class="ot">&lt;-</span> <span class="fu">map</span>(batches, <span class="cf">function</span>(batch) {</span>
<span id="cb1-655"><a href=""></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>) <span class="co"># 添加延时避免请求过快</span></span>
<span id="cb1-656"><a href=""></a>  <span class="fu">cran_downloads</span>(</span>
<span id="cb1-657"><a href=""></a>    <span class="at">packages =</span> batch,</span>
<span id="cb1-658"><a href=""></a>    <span class="at">from =</span> from_date,</span>
<span id="cb1-659"><a href=""></a>    <span class="at">to =</span> to_date</span>
<span id="cb1-660"><a href=""></a>  )</span>
<span id="cb1-661"><a href=""></a>})</span>
<span id="cb1-662"><a href=""></a></span>
<span id="cb1-663"><a href=""></a><span class="co"># 合并所有批次的结果</span></span>
<span id="cb1-664"><a href=""></a>download_stats <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(download_stats_list)</span>
<span id="cb1-665"><a href=""></a></span>
<span id="cb1-666"><a href=""></a><span class="co"># 计算总下载量</span></span>
<span id="cb1-667"><a href=""></a>download_summary <span class="ot">&lt;-</span> download_stats <span class="sc">%&gt;%</span></span>
<span id="cb1-668"><a href=""></a>  <span class="fu">group_by</span>(package) <span class="sc">%&gt;%</span></span>
<span id="cb1-669"><a href=""></a>  <span class="fu">summarise</span>(<span class="at">total_downloads =</span> <span class="fu">sum</span>(count))</span>
<span id="cb1-670"><a href=""></a></span>
<span id="cb1-671"><a href=""></a><span class="co"># 合并下载量信息</span></span>
<span id="cb1-672"><a href=""></a>transformation_packages <span class="ot">&lt;-</span> transformation_packages <span class="sc">%&gt;%</span></span>
<span id="cb1-673"><a href=""></a>  <span class="fu">left_join</span>(download_summary, <span class="at">by =</span> <span class="st">"package"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-674"><a href=""></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_downloads))</span>
<span id="cb1-675"><a href=""></a></span>
<span id="cb1-676"><a href=""></a></span>
<span id="cb1-677"><a href=""></a><span class="fu">write.xlsx</span>(</span>
<span id="cb1-678"><a href=""></a>  transformation_packages,</span>
<span id="cb1-679"><a href=""></a>  <span class="st">"data_transformation_packages_with_links_rank.xlsx"</span></span>
<span id="cb1-680"><a href=""></a>)</span>
<span id="cb1-681"><a href=""></a></span>
<span id="cb1-682"><a href=""></a><span class="co"># 添加作者信息</span></span>
<span id="cb1-683"><a href=""></a></span>
<span id="cb1-684"><a href=""></a>get_authors_from_cran <span class="ot">&lt;-</span> <span class="cf">function</span>(package_name) {</span>
<span id="cb1-685"><a href=""></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb1-686"><a href=""></a>    {</span>
<span id="cb1-687"><a href=""></a>      <span class="co"># 构建DESCRIPTION文件URL</span></span>
<span id="cb1-688"><a href=""></a>      desc_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb1-689"><a href=""></a>        <span class="st">"https://cran.r-project.org/web/packages/"</span>,</span>
<span id="cb1-690"><a href=""></a>        package_name,</span>
<span id="cb1-691"><a href=""></a>        <span class="st">"/DESCRIPTION"</span></span>
<span id="cb1-692"><a href=""></a>      )</span>
<span id="cb1-693"><a href=""></a></span>
<span id="cb1-694"><a href=""></a>      <span class="co"># 发送HTTP请求</span></span>
<span id="cb1-695"><a href=""></a>      response <span class="ot">&lt;-</span> <span class="fu">GET</span>(desc_url, <span class="fu">user_agent</span>(<span class="st">"Mozilla/5.0"</span>))</span>
<span id="cb1-696"><a href=""></a>      <span class="cf">if</span> (<span class="fu">http_status</span>(response)<span class="sc">$</span>category <span class="sc">!=</span> <span class="st">"Success"</span>) {</span>
<span id="cb1-697"><a href=""></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> <span class="cn">NA</span>, <span class="at">maintainer =</span> <span class="cn">NA</span>))</span>
<span id="cb1-698"><a href=""></a>      }</span>
<span id="cb1-699"><a href=""></a></span>
<span id="cb1-700"><a href=""></a>      <span class="co"># 解析DESCRIPTION内容</span></span>
<span id="cb1-701"><a href=""></a>      desc_content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb1-702"><a href=""></a></span>
<span id="cb1-703"><a href=""></a>      <span class="co"># 提取作者和维护者信息</span></span>
<span id="cb1-704"><a href=""></a>      author <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"Author:"</span>, desc_content)) {</span>
<span id="cb1-705"><a href=""></a>        <span class="fu">sub</span>(<span class="st">".*Author:([^</span><span class="sc">\n</span><span class="st">]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, desc_content) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-706"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-707"><a href=""></a>        <span class="cn">NA_character_</span></span>
<span id="cb1-708"><a href=""></a>      }</span>
<span id="cb1-709"><a href=""></a></span>
<span id="cb1-710"><a href=""></a>      maintainer <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"Maintainer:"</span>, desc_content)) {</span>
<span id="cb1-711"><a href=""></a>        <span class="fu">sub</span>(<span class="st">".*Maintainer:([^</span><span class="sc">\n</span><span class="st">]+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, desc_content) <span class="sc">%&gt;%</span> <span class="fu">trimws</span>()</span>
<span id="cb1-712"><a href=""></a>      } <span class="cf">else</span> {</span>
<span id="cb1-713"><a href=""></a>        <span class="cn">NA_character_</span></span>
<span id="cb1-714"><a href=""></a>      }</span>
<span id="cb1-715"><a href=""></a></span>
<span id="cb1-716"><a href=""></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> author, <span class="at">maintainer =</span> maintainer))</span>
<span id="cb1-717"><a href=""></a>    },</span>
<span id="cb1-718"><a href=""></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-719"><a href=""></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">author =</span> <span class="cn">NA</span>, <span class="at">maintainer =</span> <span class="cn">NA</span>))</span>
<span id="cb1-720"><a href=""></a>    }</span>
<span id="cb1-721"><a href=""></a>  )</span>
<span id="cb1-722"><a href=""></a>}</span>
<span id="cb1-723"><a href=""></a></span>
<span id="cb1-724"><a href=""></a><span class="co"># 为每个包获取作者信息</span></span>
<span id="cb1-725"><a href=""></a><span class="cf">if</span> (</span>
<span id="cb1-726"><a href=""></a>  <span class="sc">!</span><span class="st">"author"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(transformation_packages) <span class="sc">||</span></span>
<span id="cb1-727"><a href=""></a>    <span class="fu">all</span>(<span class="fu">is.na</span>(transformation_packages<span class="sc">$</span>author))</span>
<span id="cb1-728"><a href=""></a>) {</span>
<span id="cb1-729"><a href=""></a>  <span class="co"># 创建进度条</span></span>
<span id="cb1-730"><a href=""></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb1-731"><a href=""></a>    <span class="at">format =</span> <span class="st">"获取作者信息 [:bar] :percent | 已处理: :current / :total | 剩余: :eta"</span>,</span>
<span id="cb1-732"><a href=""></a>    <span class="at">total =</span> <span class="fu">nrow</span>(transformation_packages),</span>
<span id="cb1-733"><a href=""></a>    <span class="at">clear =</span> <span class="cn">FALSE</span></span>
<span id="cb1-734"><a href=""></a>  )</span>
<span id="cb1-735"><a href=""></a></span>
<span id="cb1-736"><a href=""></a>  <span class="co"># 获取作者信息</span></span>
<span id="cb1-737"><a href=""></a>  author_info <span class="ot">&lt;-</span> <span class="fu">map</span>(transformation_packages<span class="sc">$</span>package, <span class="cf">function</span>(pkg) {</span>
<span id="cb1-738"><a href=""></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb1-739"><a href=""></a>    <span class="fu">Sys.sleep</span>(<span class="fl">0.3</span>)</span>
<span id="cb1-740"><a href=""></a>    <span class="fu">get_authors_from_cran</span>(pkg)</span>
<span id="cb1-741"><a href=""></a>  })</span>
<span id="cb1-742"><a href=""></a></span>
<span id="cb1-743"><a href=""></a>  <span class="co"># 添加作者信息到数据框</span></span>
<span id="cb1-744"><a href=""></a>  transformation_packages<span class="sc">$</span>author <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(author_info, <span class="sc">~</span> .x<span class="sc">$</span>author)</span>
<span id="cb1-745"><a href=""></a>  transformation_packages<span class="sc">$</span>maintainer <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(author_info, <span class="sc">~</span> .x<span class="sc">$</span>maintainer)</span>
<span id="cb1-746"><a href=""></a>}</span>
<span id="cb1-747"><a href=""></a></span>
<span id="cb1-748"><a href=""></a><span class="co"># 保存结果</span></span>
<span id="cb1-749"><a href=""></a><span class="fu">write.xlsx</span>(transformation_packages, <span class="st">"data_transformation_packages_final.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">library</span>(purrr)</span>
<span id="cb2-2"><a href=""></a><span class="fu">library</span>(pkgsearch)</span>
<span id="cb2-3"><a href=""></a></span>
<span id="cb2-4"><a href=""></a>kw_download <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"api download"</span>, <span class="st">"collect"</span>, <span class="st">"gather"</span>)</span>
<span id="cb2-5"><a href=""></a>kw_clean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"preprocess data"</span>, <span class="st">"data clean"</span>, <span class="st">"parse"</span>, <span class="st">"sanitize"</span>, <span class="st">"scrub"</span>,  <span class="st">"correct"</span>, <span class="st">"rectify"</span>, <span class="st">"standardize"</span>)</span>
<span id="cb2-6"><a href=""></a>kw_transform <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"convert data"</span>, <span class="st">"reformat"</span>, <span class="st">"transform"</span>, <span class="st">"aggregate"</span>, <span class="st">"rescale"</span>, <span class="st">"reshape"</span>, <span class="st">"recode"</span>, <span class="st">"modify"</span>, <span class="st">"restructure"</span>)</span>
<span id="cb2-7"><a href=""></a></span>
<span id="cb2-8"><a href=""></a>kw_short <span class="ot">&lt;-</span> <span class="fu">c</span>(kw_download[<span class="dv">1</span>], kw_clean[<span class="dv">1</span>], kw_transform[<span class="dv">1</span>])</span>
<span id="cb2-9"><a href=""></a></span>
<span id="cb2-10"><a href=""></a>ls_packages <span class="ot">&lt;-</span> <span class="fu">map</span>(kw_short, \(keyword){</span>
<span id="cb2-11"><a href=""></a>  <span class="fu">pkg_search</span>(keyword, <span class="at">format =</span> <span class="st">"long"</span>, <span class="at">size =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href=""></a>    <span class="fu">select</span>(package, title, <span class="at">maintainer =</span> maintainer_name) </span>
<span id="cb2-13"><a href=""></a>}) <span class="sc">|&gt;</span> </span>
<span id="cb2-14"><a href=""></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"download"</span>, <span class="st">"clean"</span>, <span class="st">"transform"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="想法3使用方式" class="slide level2">
<h2>想法3：使用方式</h2>
<div class="r-stack">
<div class="r-hstack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/css_xinqingnian1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img data-src="https://drhuyue.site:10002/sammo3182/figure/css_xinqingnian1.png" class="quarto-figure quarto-figure-center" height="600"></a></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/css_xinqingnian2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img data-src="https://drhuyue.site:10002/sammo3182/figure/css_xinqingnian2.png" class="quarto-figure quarto-figure-center" height="600"></a></p>
</figure>
</div>
</div>
<div class="r-hstack fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/weibo_net-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img data-src="https://drhuyue.site:10002/sammo3182/figure/weibo_net-1.png" class="quarto-figure quarto-figure-center" height="600"></a></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/weibo_net-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img data-src="https://drhuyue.site:10002/sammo3182/figure/weibo_net-2.png" class="quarto-figure quarto-figure-center" height="600"></a></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<p>《新青年》前两卷的文本分析的结果，告诉我们：《新青年》前期并非仅高举民主和科学的大旗</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="主观且不负责地认为" class="slide level2">
<h2>主观且不负责地认为</h2>
<div class="overlay-container">
<div class="overlay-image">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://drhuyue.site:10002/sammo3182/figure/css_kanglongyouhui.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img data-src="https://drhuyue.site:10002/sammo3182/figure/css_kanglongyouhui.png" class="quarto-figure quarto-figure-center" height="600"></a></p>
</figure>
</div>
</div>
<div class="overlay-text-over fragment">
<ul>
<li>“小孩子才做选择”
<ul>
<li>学习大语言模型的运作原理</li>
<li>“近读”读不出的内容</li>
</ul></li>
<li>量力而行</li>
</ul>
</div>
</div>
</section>
<section>
<section id="敬请指正" class="title-slide slide level1 center" data-background="#43464B">
<h1>敬请指正</h1>
<div style="text-align: right; margin-top: 1em">
<p><a href="https://github.com/sammo3182"><svg viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"> <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>&nbsp; sammo3182</a></p>
<p><a href="mailto:yuehu@tsinghua.edu.cn"><svg viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"> <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path> <polyline points="22,6 12,13 2,6"></polyline></svg>&nbsp; yuehu@tsinghua.edu.cn</a></p>
<p><a href="https://www.drhuyue.site"><svg viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"> <circle cx="12" cy="12" r="10"></circle> <line x1="2" y1="12" x2="22" y2="12"></line> <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>&nbsp; https://www.drhuyue.site</a></p>
<p><a href="https://user-images.githubusercontent.com/6463211/232207708-b0e64eee-7fb3-45a4-9779-ec52397f786c.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img data-src="https://user-images.githubusercontent.com/6463211/232207708-b0e64eee-7fb3-45a4-9779-ec52397f786c.png" height="250"></a></p>
</div>
</section>
<section id="请问题转身" class="slide level2 center">
<h2>请问题转身</h2>
<div class="large fragment">
<ol type="1">
<li>社会科学学者要开始（系统）学习大语言模型吗？</li>
<li>传播学学者之于跨学科学者的<em>理论优势</em>是什么？</li>
</ol>
</div>
</section>
<section id="参考文献" class="slide level2 smaller scrollable">
<h2>参考文献</h2>
<div class="ref">

</div>

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Hu2020a" class="csl-entry" role="listitem">
Hu, Yue. 2020. <span>“Refocusing Democracy: The Chinese Government’s Framing Strategy in Political Language.”</span> <em>Democratization</em> 72 (2): 302–20. <a href="https://doi.org/10.1080/13510347.2019.1690461">https://doi.org/10.1080/13510347.2019.1690461</a>.
</div>
<div id="ref-YangEtAl2024a" class="csl-entry" role="listitem">
Yang, Jingfeng, Hongye Jin, Ruixiang Tang, Xiaotian Han, Qizhang Feng, Haoming Jiang, Shaochen Zhong, Bing Yin, and Xia Hu. 2024. <span>“Harnessing the Power of LLMs in Practice: A Survey on ChatGPT and Beyond.”</span> <em>ACM Trans. Knowl. Discov. Data</em> 18 (6): 160:1–32. <a href="https://doi.org/10.1145/3649506">https://doi.org/10.1145/3649506</a>.
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="llm_thoughts_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="llm_thoughts_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/reveal-spotlight/spotlight.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="llm_thoughts_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="llm_thoughts_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'spotlight': {"size":50,"lockPointerInsideCanvas":false,"toggleSpotlightOnMouseDown":false,"spotlightOnKeyPressAndHold":73,"spotlightCursor":"none","presentingCursor":"default","initialPresentationMode":true,"disablingUserSelect":true,"fadeInAndOut":100,"useAsPointer":false,"pointerColor":"red"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealSpotlight, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
                // target, if specified
                link.setAttribute("target", "_blank");
                if (link.getAttribute("rel") === null) {
                  link.setAttribute("rel", "noopener");
                }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":false,"openEffect":"fade","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>