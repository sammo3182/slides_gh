---
title: "ç¤¾ä¼šç½‘ç»œåˆ†æ: åˆ†æç½‘ç»œ"
subtitle: "æ”¿åŠ¡å¤§æ•°æ®åº”ç”¨ä¸åˆ†æ (80700673)"
author: "èƒ¡æ‚¦"
institute: "æ¸…åå¤§å­¦ç¤¾ä¼šç§‘å­¦å­¦é™¢" 
bibliography: t_politicalData.bib

format: 
    revealjs:
        css: https://www.drhuyue.site/slides_gh/css/style_basic.css
        theme: ../../../css/goldenBlack.scss
        number-sections: true
        slide-number: true
        filters: [appExclusion.lua] # not count appendices into page number
        incremental: false
        preview-links: true # open an iframe for a link
        link-external-newwindow: true
        self-contained: false
        chalkboard: false # allwoing chalk board B, notes canvas C
        # callout-icon: false
        show-slide-number: all # `speaker` only print in pdf, `all` shows all the time
        show-notes: false
        title-slide-attributes:
            data-background-image: https://gitlab.com/sammo3182/backup/raw/85b3c1ad4b459d7a9f901f124b936428eda5fcaf/logo_THPS.png?inline=true
            data-background-size: 250px   
            data-background-position: top 10% right 5%
        default-image-extension: png
revealjs-plugins:
    - spotlight
lightbox: 
    match: auto
    effect: fade
spotlight:
    size: 50
    presentingCursor: default
    toggleSpotlightOnMouseDown: false
    spotlightOnKeyPressAndHold: 73 # keycode for "i"

execute: 
    echo: false
editor_options: 
    chunk_output_type: console
editor: 
    render-on-save: true
---


```{r}
#| label: setup
#| include: false

if (!require(pacman)) install.packages("pacman")
library(pacman)

p_load(
  knitr, 
  sna, 
  network, 
  ergm,
  data.table, 

  # hierarchical clustering
  ggdendro,
  dendextend,  

  # non-hierarchical
  cluster,
  clusterCrit,
  mclust,
  dbscan,
  kernlab,

  patchwork,
  drhutools,
  tidyverse
) # data wrangling # data wrangling

# Functions preload
set.seed(313)


# Visualization
theme_set(
  theme_minimal(base_size = 18)
)

theme_update(
  plot.title = element_text(size = 18),
  axis.title = element_text(size = 22),
  axis.text = element_text(size = 18)
)
```

## æ¦‚è¦ {.unnumbered}

::::{.columns style="text-align:center"}

:::{.column .nonincremental width="50%"}

*ç†è§£ç½‘ç»œ*

ç›®çš„ï¼šæè¿°ç½‘ç»œç»“æ„ï¼Œè¯†åˆ«ç½‘ç»œç‰¹å¾

+ ç½‘ç»œæ–¹æ³•è®º &check;
+ ç½‘ç»œè¦ç´   &check;
+ è‡ªæˆ‘ä¸­å¿ƒç½‘ç»œ  &check;

:::

:::{.column .nonincremental width="50%"}

*åˆ†æç½‘ç»œ*

ç›®çš„ï¼šæ­ç¤ºç½‘ç»œæ„æˆå› ç´ å’ŒåŸå› 

+ é‚»å±…åˆ†æï¼ˆâ€œè¿‘æ™¯â€ï¼‰
+ æ‰©æ•£åˆ†æï¼ˆâ€œä¸­æ™¯â€ï¼‰
+ [å…¨ç½‘åˆ†æï¼ˆâ€œè¿œæ™¯â€ï¼‰*]{.grayLight}

:::

::::


# é‚»å±…åˆ†æ

## é‚»å±…ç±»å‹

:::{.nonincremental .large style="text-align:center; margin-top: 3em"}

1. Dyads
1. Triads
1. Communities

:::

## Dyads Distribution

:::: {.columns}

:::{.column width="50%" .fragment}

1. None: A &nbsp; B
1. Arc: A &rarr; B; B &larr; C
1. Reciprocal: A &harr; B

:::

:::{.notes}

Arc is a directed edge

Both are using the described the same phenomenon

:::

:::{.column width="50%" .fragment}

![](https://drhuyue.site:10002/sammo3182/figure/sna_arc.png){height=400}

:::

::::

:::: {.columns}

::: {.column .fragment width="50%"}

- Dyadic: $$R = \frac{\#Reciprocated\ Pairs}{\# Connected\ Pairs}$$

:::

::: {.column .fragment width="50%"}

- Arc: $$R = \frac{\#Reciprocated\ Arcs}{\# Total\ Arcs}$$ 

:::

::::



## Triads

Aã€Bã€Cä¸‰æ–¹ï¼Œå­˜åœ¨å‡ ç§å»ºç«‹å…³ç³»çš„æ–¹å¼? 

:::{.fragment style="text-align:center"}

(2<sup>2</sup>)<sup>3</sup> = 64

![Triad census, @PrellSkvoretz2008, fig. 1](https://drhuyue.site:10002/sammo3182/figure/sna_triads.gif){height=500 fig-align="center"}

:::

## Transitive Triads

A&rarr;B&rarr;C + A&rarr;C

![@PrellSkvoretz2008, fig. 1](https://drhuyue.site:10002/sammo3182/figure/sna_triadsTrans.png){height=550 fig-align="center"}

## Vacuous Triads

![@PrellSkvoretz2008, fig. 1](https://drhuyue.site:10002/sammo3182/figure/sna_triadsVac.png){height=550 fig-align="center"}

:::{.notes}

/v'Ã¦kjuÉ™s/

No feature a directed path

Used to study social capital: closure (all nodes are reciprocal) and brokerage

:::


## Dyads in triads

![](https://drhuyue.site:10002/sammo3182/figure/sna_taoyuan.jpeg){fig-align="center" height=400}

- Simmelian tie: Dyads åŒæ—¶ä¸ç¬¬ä¸‰æ–¹æœ‰äº’æƒ å…³ç³»
    - Dyads more stable when embedded in triads

## åº”ç”¨

å®šä¹‰ç½‘ç»œç»“æ„[å¹³è¡¡]{.red}ï¼ˆStructural Balanceï¼‰

:::{.r-stack}

![@MaozEtAl2007](https://drhuyue.site:10002/sammo3182/figure/sna_structuralBalance.jpg){.fragment fig-align="center" height=550}

![](https://drhuyue.site:10002/sammo3182/figure/sna_structuralBalance.png){.fragment fig-align="center" height=550}

:::


:::{.notes}

The enemy of my enemy is my friends.

è¿‡å¾€186å¹´ä¸­ï¼ŒIRå……æ»¡äº†imbalance, å‹ä¹‹æ•Œä¸ºå‹ï¼Œå‹by alliances, æ•Œmilitary disputes

Realistic factors increase imbalance: strategic rivalry, opportunism and exploitative tendencies, capability parity, and contiguity

Liberal factors reduce it: joint democracy, economic interdependence, shared
IGO membership

:::


## Community: Beyond k-ads {background-image="https://drhuyue.site:10002/sammo3182/figure/sna_smallWorld_disney.jpg" background-position="center" background-size="contain"}

::::{.overlay-container}

::: {.overlay-image .fragment}

![å°ä¸–ç•Œ, @KlovdahlEtAl1994](https://drhuyue.site:10002/sammo3182/figure/sna_smallWorld.bmp){fig-align="center" height=600}

:::

::: {.overlay-text-over .fragment}

+ 695 äºº
+ å¹³å‡è·ç¦»ä¸ºå¤§çº¦5æ­¥
+ å¹³å‡æ¯äºº3æ­¥å†…å°±èƒ½è¦†ç›–75ä¸ªå…¶ä»–äºº

:::

::::


:::{.notes}

Disneyland: it's a small world

è¶…è¶Šstrong, presented tiesï¼Œå°ä¸–ç•Œç½‘ç»œæ˜¯ä¸€ç±»ç‰¹æ®Šçš„å¤æ‚ç½‘ç»œç»“æ„ï¼Œåœ¨è¿™ç§ç½‘ç»œä¸­å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹å½¼æ­¤å¹¶ä¸ç›¸è¿ï¼Œä½†ç»å¤§éƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´ç»è¿‡å°‘æ•°å‡ æ­¥å°±å¯åˆ°è¾¾ï¼Œæ¯”å¦‚å…­åº¦ç©ºé—´ç†è®ºï¼ˆå®é™…å¯èƒ½åœ¨2å·¦å³ï¼Œæœ€é•¿ä¸è¿‡8ï¼‰


**Reachability in Colorado Springs**

- Epidemic Potential in Human Sexual Networks
- sexual contact only, STD 
- High-risk actors over 4 years

:::


## å®šä¹‰ç¤¾ç¾¤

```{r}
#| label: exampleData
#| fig-align: center
#| fig-height: 5

data_example <- data.table(
  x = c(
    rnorm(10, 3.5, 0.1), rnorm(10, 2, 0.1),
    rnorm(10, 4.5, 0.1), c(5, 1.9, 3.95)
  ),
  y = c(
    rnorm(10, 3.5, 0.1), rnorm(10, 2, 0.1),
    rnorm(10, 4.5, 0.1), c(1.65, 2.9, 4.2)
  )
)

fg_original <- ggplot(data_example, aes(x, y)) +
  geom_point(alpha = 0.75, size = 8)

fg_original
```


::::{.columns style="text-align:center"}

:::{.column width="50%" .fragment}

Top Down: 

Cores &rarr; factions &rarr; modularity

:::

:::{.column width="50%" .fragment}

Bottom Up: 

Cliques &rarr; n-cliques &rarr; n-clans

:::

::::


## (K-)Core

The k-core of a network graph G is the maximal subgraph H &sube; G in which all vertices have degree at least k

![](https://drhuyue.site:10002/sammo3182/figure/sna_kcore.png){height=500 fig-align="center"}

:::{.notes}

https://www.youtube.com/watch?v=rHVrgbc_3JA

<img src="https://drhuyue.site:10002/sammo3182/figure/sna_kcoresSolution.png" height = 300 />

æ¯ä¸ªäººéƒ½ä¸å…¶ä»–è‹¥å¹²äººç›¸è¿

4-core is the null graph of the original graph or DNE (does not exist)

:::


## Faction

> é‚»å›½ç›¸æœ›ï¼Œé¸¡çŠ¬ä¹‹å£°ç›¸é—»ï¼Œæ°‘è‡³è€æ­»ï¼Œä¸ç›¸å¾€æ¥ã€‚ [@WangBiLouYuLie2011]

::::{.columns style="text-align:center; margin-top: 2em"}

:::{.column width="50%" .fragment}

![](https://drhuyue.site:10002/sammo3182/figure/sna_faction.png){height=400 fig-align="center"}

:::

:::{.notes}

ç»„å†…ç´§å¯†è¿ç»“ï¼Œæ— è·¨ç»„è¿ç»“ã€‚

:::

:::{.column width="50%" .fragment}

- å®ç°ï¼šArranging actors to resemble the ideal as closely as possible.
- æ­¥éª¤ï¼š 
    1. Partition
    1. Evaluation
    1. Moving
    1. Evaluation, again
    1. Repeat

:::

::::

:::{.notes}

+ Partition the network
+ Evaluate how good the partition is
+ Move some actors from one group to another
+ See if there's improvement
+ Keep repeating the above steps until further improvement is impossible

:::

## è¾¨åˆ«ç¤¾ç¾¤ ï¼ˆunsupervisedï¼‰

Aka., Cluster analysis

::::{.columns style="text-align:center"}

:::{.column width="50%" .fragment}

Non-hierarchical

::::{.overlay-container}

::: {.overlay-image}

![](https://drhuyue.site:10002/sammo3182/figure/sna_agglomerative.bmp){height=500 fig-align="center"}

:::

::: {.overlay-text-over .fragment}

- Centroid-based
- Model-based
- Density-based
- Grid-based

:::

::: {.notes}

k-mean æ˜¯ä¸€ç§centroid-basedæ–¹æ³•

:::

::::


:::



:::{.column width="50%" .fragment}

Hierarchical

::::{.overlay-container}

::: {.overlay-image}

![](https://drhuyue.site:10002/sammo3182/figure/sna_divisive.bmp){height=500 fig-align="center"}

:::

::: {.overlay-text-over .fragment}

- Agglomerative
- Divisive

:::

::::


:::


::::




## ç¤¾ç¾¤ç‰¹å¾ï¼šå†…èšæ€§ (cohesion)

A.k.a., å‡èšåŠ›

![è¿ç»“ä¸å¯è¾¾](https://drhuyue.site:10002/sammo3182/figure/sna_cohesiveII.png){height=500 fig-align="center"}

:::{.notes}

ç”±ä¸€ç‚¹åˆ°å…¶ä»–ç‚¹pathsè¶Šå¤šå¯è¾¾æ€§è¶Šé«˜

:::

## æœ€å°å†…èšæ€§

::::{.columns style="text-align:center; margin-top: 2em"}

:::{.column width="50%" .fragment}

é«˜ &rArr;

+ æƒåŠ›é›†ä¸­
+ ä¿¡æ¯é›†ä¸­
+ ä¸å¹³ç­‰
+ ä¸ªä½“è¡Œä¸ºå½±å“å¤§
+ ç¢ç‰‡åŒ–ç»“æ„

:::

:::{.column width="50%" .fragment}

ä½ &rArr;

+ æƒåŠ›åˆ†æ•£
+ ä¿¡æ¯é€æ˜
+ å¹³ç­‰
+ ä¸ªä½“è¡Œä¸ºéš¾ä»¥æ’¼åŠ¨ç»“æ„
+ å‡è¡¡ç»“æ„

:::

::::

![](https://drhuyue.site:10002/sammo3182/figure/sna_minimalCohesion.png){.fragment height=300 fig-align="center"}


:::{.notes}
Minimal cohesion: without that node, the network will break apart
:::

## Modularity

![](https://drhuyue.site:10002/sammo3182/figure/sna_moduality.png){height=600 fig-align="center"}

::: {.notes}

æ¯”èµ·è¯†åˆ«å‡ºç¾¤ä½“ï¼Œæ›´å…³æ³¨ç¤¾ç¾¤å¦‚ä½•[ç»„æˆ]{.red}ç¤¾ä¼šã€‚

:::

## åº”ç”¨

![@TamburriniEtAl2015](https://drhuyue.site:10002/sammo3182/figure/sna_languageIdentity.png){height=600 fig-align="center"}

:::{.notes}

modularity maximization algorithm

word-usage frequencies (solid bars at the top of eachplot),   
word-ending frequencies (slashed bars in the middle)    
apostrophe (/É™p'É’strÉ™fi/) usage (crossed bars at the bottom).

1. äººä»¬æ ¹æ®è‡ªå·±çš„communityæ”¹å˜è¯­è¨€ç‰¹å¾
1. communitiesè¶Šç‹¬ç«‹ï¼Œè¯­è¨€ç‰¹å¾è¶Šæ˜æ˜¾

:::

## å°ç»“

- é‚»è¿‘ç‚¹å…³ç³»: dyads, triads
- ç¤¾ç¾¤å…³ç³»ï¼š
    - Core/faction
    - è¾¨è¯†ç¤¾ç¾¤
      - Hierarchical/non-hierarchical
    - Modularity


# æ‰©æ•£åˆ†æ

## åˆ†æå¯¹è±¡

![](https://drhuyue.site:10002/sammo3182/figure/sna_covid19difussion.gif){height=450 fig-align="center"}

:::{style="text-align:center"}

1. è°æ˜¯â€œå§‹ä½œä¿‘è€…â€ vis-a-vis â€œç¬¬ä¸€ä¸ªåƒèƒèŸ¹çš„äººâ€
1. æ‰©æ•£è¿‡ç¨‹æ˜¯è°å½±å“äº†è°
1. ï¼ˆäº‹ä»¶ã€æ³•å¾‹ã€æ”¿ç­–ã€ä¹ æƒ¯ etc.ï¼‰é‡‡ç”¨çš„æ—¶é—´

:::

## åˆ†æè§†è§’

![@WuEtAl2018, fig. 1](https://drhuyue.site:10002/sammo3182/figure/sna_diffusionQ.png){height=400 fig-align="center"}

- è”ç³»ç½‘ç»œï¼ˆContact networkï¼‰ï¼šâ€œPatient 0â€ï¼ˆP0ï¼‰æ•ˆåº”: è°æ¥è§¦äº†P0ï¼Œæœ€ç»ˆæ„ŸæŸ“äº†è°
- æš´éœ²ç½‘ç»œï¼ˆExposure networkï¼‰ï¼šè”ç³»ç½‘ç»œçš„å­é›†ï¼Œè°æ˜¯æ˜“æ„Ÿäººç¾¤
- ä¼ åŠ¨ç½‘ç»œ (Transmission network)ï¼šä¼ æ’­ï¼ˆä¼ é€’ï¼‰è·¯å¾„ç©¶ç«Ÿæ˜¯æ€æ ·çš„

::: {.notes}

How network exposure works in a diffusion process. The first 2 rows show the evolution of an adoption process on an example network, starting with a seed labeled 1. The numbered circles denote the order of adoption, and arrows represent transmission of the innovation. The time just after the ith adoption is denoted as urn:x-wiley:sim:media:sim7658:sim7658-math-0012. Light gray lines and circles are susceptible edges and individuals at the moment of each adoption, respectively. The last 4 lines show how the total hazard/exposure of adoption felt by susceptible individuals changes over time, assuming constant edgewise hazards. The exposure increases one step whenever the number of prior adopters connected to the individual increases. The shaded area under each subject's curve is the cumulative exposure experienced by that subject

:::


## åº”ç”¨ï¼šé—¨æ§›æ•ˆåº”

::::{.columns style="text-align:center; margin-top: 2em"}

:::{.column width="70%"}

![@Valente1996](https://drhuyue.site:10002/sammo3182/figure/sna_exposure.png){height=600 fig-align="center"}

:::

:::{.notes}

exposureï¼šæŒ‰æ—¶é—´adopt

Threshold: Early adopter, early majority, late majority, laggards.

ä¸ªä½“ç½‘ç»œä¸å…¨ç½‘è§’åº¦ç†è§£threshold

Fig. l(a) shows a typical personal network for a doctor (from Peoria, identification number 20) who was connected to five people: two friends, two discussion partners and one advice partner. Fig. l(b) shows the same personal network 3 months later, when the two discussion partners had adopted tetracycline. Now the individual doctor is exposed to the innovation through his/her personal network partners. The degree of exposure is computed by dividing the number of adopters, 2, by the total size of the personal network, 5. Thus, the degree of exposure to the innovation is 40% for this doctor at time-period 3. In Fig. l(d), the individual doctor adopts at time-period 8 when all of his/her network partners have adopted. The adoption threshold is the exposure at timeof- adoption. In this example, the doctor adopted tetracycline after all of the other doctors in his/her network adopted. at a threshold of 100%. The proportion of adopters in an individualâ€™s personal network

:::


:::{.column width="30%" .fragment}

åŸºäºç½‘ç»œçš„åˆ†æå¯ä»¥ï¼š

- å¤šæ ·åŒ–å¯¹è¡Œä¸ºè”“å»¶ï¼ˆbehavioral contagionï¼‰çš„å®šä¹‰
- é¢„æµ‹è”“å»¶è¶‹åŠ¿
- è¯†åˆ«å§‹ä½œä¿‘è€…å’Œè·Ÿä»è€…

:::

::::


## æ‰©æ•£æœºåˆ¶

::::{.columns}

:::{.column width="20%" .fragment}

**ä¸»åŠ¨æœºåˆ¶**

+ å­¦ä¹ 
+ ç«äº‰
+ è®¤åŒ

:::

:::{.column width="30%" .fragment}

**è¢«åŠ¨æœºåˆ¶**

+ Common shock
+ Homophily
+ Strategic interaction

:::

:::{.column width="50%" .fragment}

ğŸŒ° 

![@DesmaraisEtAl2015, tbl. 2](https://drhuyue.site:10002/sammo3182/figure/sna_diffusionFlorida.png){height=300 fig-align="center"}

+ iå·æ¯”jå·æ—©é‡‡ç”¨ä¸€ä¸ªæ”¿ç­–çš„æ¬¡æ•°
+ åŒä¸€æ”¿ç­–iå’Œjé‡‡ç”¨çš„æ—¶é—´å·®
+ ié‡‡ç”¨åœ¨å¤šå¤§ç¨‹åº¦ä¸Šèƒ½é¢„æµ‹jçš„é‡‡ç”¨

:::{.notes}

ä½›ç½—é‡Œè¾¾æ˜¯è¿‘äº”å¹´policyçš„ä¸»è¦æ¨åŠ¨è€…

ä¸€ä¸ªå·è¢«è®¤ä¸ºinnovativeï¼Œå¹¶ä¸å•çº¯å–å†³äºå®ƒå¤šå¿«é‡‡ç”¨ä¸€ä¸ªpolicy

:::

:::

::::


## ä¸€ç§ç°è±¡ï¼Œä½•ç§æœºåˆ¶

:::: {.columns}

::: {.column width="50%"}

*Influencing vs. homophily*

![@AralEtAl2009](https://drhuyue.site:10002/sammo3182/figure/sna_homophilyVsInfluenced.png){fig-align="center" height=500}

[ä¼ ç»Ÿæ–¹æ³•ä¼šé«˜ä¼°å½±å“æœºåˆ¶ 300-700%]{.fragment}

:::{.notes}

åœ¨ç”¨Yahooï¼Goï¼ˆç±»ä¼¼äºä¼ä¸šå¾®ä¿¡ï¼‰ä½¿ç”¨è€…æ•°æ®

æ ¹æ®èŠ‚ç‚¹çš„ç½‘ç»œæ€§è´¨ï¼šåœ¨æ§åˆ¶äº†nodesçš„å„ç§è¡Œä¸ºå’Œä¸ªä½“ç‰¹ç‚¹åï¼Œæ¯”è¾ƒé‚£äº›æœ‰å¾ˆå¤šadopted friends å’Œæ²¡æœ‰é‚£ä¹ˆå¤šadopted friendsä¹‹äºº

:::

:::

::: {.column .fragment width="50%"}

Influencing vs. affiliating

![@LazerEtAl2010](https://drhuyue.site:10002/sammo3182/figure/sna_affiliatingVsInfluenced.png){fig-align="center" height=500}

[â€œå…³ç³» > çŸ¥è¯†â€]{.fragment}

:::{.notes}

+ 164å…¬å…±æ”¿ç­–2å¹´çº§ç¡•å£«ç”Ÿ
+ åŒcohort
+ åˆšå…¥å­¦(T1)ï¼Œç¬¬äºŒå­¦æœŸå¼€å§‹(T2)ï¼Œç¬¬äºŒå­¦æœŸç»“æŸ(T3)

ä¸ªä½“æ ¹æ®å…¶associatesæ”¹å˜æ­£æ”¿æ²»çœ‹æ³•ï¼Œè¿™ç§conformityå—social ties è€Œétask tieså½±å“ã€‚è€Œæ”¿æ²»çœ‹æ³•åè¿‡æ¥å¯¹relationshipå½±å“ä¸å¤§ã€‚

:::

:::

::::

## å°ç»“

:::: {.columns}

::: {.column width="50%"}

- åˆ†æå¯¹è±¡
    - P0
    - ä¸Šæ¸¸ &rarr; ä¸‹æ¸¸
    - æ—¶é—´ã€æ¡ä»¶
- åˆ†æè§†è§’
  - Contact network
  - Exposure network
  - Transmission network

:::

::: {.column width="50%"}

- æ‰©æ•£æœºåˆ¶
  - ä¸»åŠ¨æœºåˆ¶ï¼šå­¦ä¹ ã€è®¤åŒã€ç«äº‰
  - è¢«åŠ¨æœºåˆ¶ï¼šshockï¼Œhomophilyï¼Œstrategy
  - ä¸€ç§è¡Œä¸ºï¼Œè¾¨ææœºåˆ¶

:::

::::

# å…¨ç½‘åˆ†æï¼ˆä¸€ç¥ï¼‰


## ç½‘ç»œåˆ†æçš„ç»Ÿè®¡æ¨æ–­

::::{.columns style="text-align:center; margin-top: 2em"}

:::{.column width="50%" .fragment}

**ç»Ÿè®¡æ¨æ–­æµç¨‹**

1. ç¡®å®šH<sub>0</sub>
1. ç¡®å®šæ˜¾è‘—æ€§æ ‡å‡†
1. æ£€éªŒè§‚æµ‹ç»Ÿè®¡æ˜¯å¦åœ¨â€œnull distributionçš„å°¾å·´ä¸Šâ€
1. æ‹’ç»/ä¸æ‹’ç»H<sub>0</sub>

::: {.callout-important .fragment}

## ä¼ ç»Ÿè®¡é‡çš„å‰æå‡å®š

+ Sample distribution (â€œå‡è£…â€çŸ¥é“)
+ IID observations ï¼ˆâ€œé¢„è®¾â€æ»¡è¶³ï¼‰

:::

:::

:::{.column width="50%" .fragment}

**ç½‘ç»œåˆ†æ**ï¼šç ”ç©¶ä¸ªä½“ &rarr; ç ”ç©¶å…³ç³»

1. Sampleæ˜¯ä»€ä¹ˆï¼Ÿ
1. Parameteræ€ä¹ˆè®¾ç½®ï¼Ÿ
1. H<sub>0</sub>æ˜¯ä»€ä¹ˆ

::: {.fragment}

&dArr;

éšæœºç½‘ç»œåˆ†æ

:::


:::{.notes}

- Sample: å…³ç³»
- Parameterï¼šå¯¹æ¯”éšæœºç½‘ç»œ
- H<sub>0</sub>: Xä¸å½±å“ç½‘ç»œï¼ˆå…³ç³»ï¼‰ç»“æ„

:::

:::

::::

## éšæœºç½‘ç»œåˆ†æå¸¸è§æ–¹æ³•

- Conditional uniform graph (CUG)
- Quadratic assignment procedure (QAP)
- Exponential family random graph models (ERGM)


## åˆ†æç›®æ ‡

::::{.columns}

:::{.column width="35%"}

*é€šç›˜è€ƒè™‘*ï¼š

1. Nodal
1. Edge (Dyadic)
1. Network (Structural)

:::

:::{.notes}

æ›´å…³é”®åœ¨ï¼Œåœ¨ç†è§£ä¸€ä¸ªçš„æ—¶å€™è€ƒè™‘åˆ°å…¶ä»–å±‚æ¬¡é—®é¢˜ï¼Œâ€œå…¨æ–¹ä½è§†å¬æ„Ÿå—â€

ä½†å¦‚æœå¯¹structureä¸æ„Ÿå…´è¶£ï¼Œä¸éœ€è¦ç”¨ERGM

Latent space models ä¹Ÿå¯ä»¥æ§åˆ¶structureï¼Œä½†ç›®çš„åœ¨äºå»é™¤è€Œä¸æ˜¯careï¼Œè€Œä¸”æ˜¯åŸºäºbaysian

:::

:::{.column width="65%"}

:::{.fragment}

*Interdependence*

1. é¢å¯¹å…±åŒçš„æ•Œäººï¼Œæ˜¯å¦å‡å°å½¼æ­¤æ•Œæ„ï¼Ÿ
1. åˆä½œè€…é€‰æ‹©è¿‡ç¨‹ç»ˆå¾—Popularity effects

:::

:::{.fragment}

*Dyadic Covariate*

1. å›½å®¶æ˜¯å¦ä¸ç›¸åŒæ”¿ä½“å›½å®¶æ›´å¯èƒ½ç»“ç›Ÿ
1. åŒä¸ªå…šæ´¾è®®å‘˜æ˜¯å¦æ¯”ä¸åŒå…šæ´¾è®®å‘˜åˆä½œæ›´å¤š

:::

:::{.fragment}

*Structural*

1. Cosponsorshipæ˜¯å¦å­˜åœ¨äº’æƒ 
1. æ•™å®¤ä¸­æŒ‡å®šåŒæ¡Œï¼Œæ˜¯å¦æ”¹å˜ä¸åŒäººç¾¤å…³ç³»

:::

:::{.notes}

è”åˆæŠ—æ•Œ vs "æ”˜å¤–å¿…å…ˆå®‰å†…"

partisanship vs. issues

:::

:::

::::

## ERGM

$$
\begin{align}
P(N, \boldsymbol{\theta}) =& \frac{exp(\sum_i\theta_iz_i(N))}{\kappa(\theta)}.\\
\downarrow& \\
P(N, \boldsymbol{\theta}) =& \frac{exp(\boldsymbol{\theta'h}(N))}{\sum_{N^*\in N}exp(\boldsymbol{\theta'h}(N^*))}.
\end{align}
$$

- N* æ˜¯ç‰¹å®šnetwork statistics çš„æ•°ç›®
- åˆ†æ¯éšæ‰€åŠ statisticsè€Œå˜å¾—å¤æ‚

::: {.callout-important .fragment}

## ERGM Assumptions

1. Modelæ˜¯æ­£ç¡®çš„
1. åœ¨ç‰¹å®šnetwork statisticsä¸‹ï¼Œè§‚æµ‹åˆ°ä»»ä½•ä¸¤ä¸ªå…·æœ‰åŒæ ·ç½‘ç»œå±æ€§çš„networksçš„å‡ ç‡æ˜¯ç›¸åŒçš„

:::

:::{.notes}

1. Model is correctly specified
1. Given a set of network statistics, there's equal probability of observing any two networks with the same values of those statistics.

:::

## Take-Home Points

::::{.columns style="text-align:center"}

:::{.column width="50%" .fragment}

Edge Effect (é‚»å±…æ•ˆåº”)

+ Dyad/Triad Census
+ ç¤¾ç¾¤ (Homophily)

Diffusion Effect (æ‰©æ•£åˆ†æ)

+ è”ç³»
+ æš´éœ²
+ ä¼ åŠ¨

:::

:::{.column width="50%"}

Complete Network analysis (å…¨ç½‘åˆ†æ)

- å¯ç”¨æ¨¡å‹
- ERGM

:::

::::

## å‚è€ƒæ–‡çŒ®

::: {#refs}
:::

# é™„å½•ï¼šèšç±»åˆ†æ {.appendix}

::: {.notes}

https://petolau.github.io/Overview-clustering-methods-in-R/

https://github.com/PetoLau/petolau.github.io/blob/master/_rmd/2024-01-11-Overview-clustering-methods-in-R.Rmd

:::

## Toy data

```{r}
#| label: comparison
#| fig-align: center
#| fig-height: 6
#| fig-cap: "èšç±»å‰åå¯¹æ¯”"

kmed_res <- pam(data_example, 3)$clustering

data_example[, class := as.factor(kmed_res)]

fg_colored <- ggplot(data_example, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 8) +
  scale_color_gb()

fg_original + fg_colored
```

## å±‚æ¬¡èšç±» (Hierarchical clustering)

![Agglomerative vs. Divisive](https://drhuyue.site:10002/sammo3182/figure/sna_agglomerativeDivisive.bmp){height=600 fig-align="center"}

:::{.notes}

- Agglomerative (/É™'É¡lÉ”mÉ™rÉ™tiv/) åŸºäº a wide variety of similarity measuresï¼Œä»empty graph ï¼ˆæ²¡æœ‰ä»»ä½•tiesï¼‰å¼€å§‹ï¼Œå°†æœ€similarçš„nodesåŠ åœ¨ä¸€èµ·
- Divisive ä»complete graph å¼€å§‹ï¼Œ dedrogramæ¨ªåˆ‡äºŒåˆ†ç‚¹ï¼‰ï¼ˆhalting pointsï¼‰

Aå–„äºå‘ç°å¼ºè¿ç»“communityï¼Œ Dä¸ä¼šå»é™¤peripheral verticesï¼›ç±»ä¼¼EFAå’ŒPCAçš„å·®åˆ«

:::

## å±‚æ¬¡æ–¹å¼æ–¹æ³•ä¸æ ‡å‡†

:::: {.columns}

::: {.column width="30%"}

*å¸¸è§åˆ†ç±»ï¼ˆå‰ï¼‰linkage*

- Single-linkage
- Complete-linkage
- Average-linkage
- Centroid-linkage
- Ward's minimum variance method

:::

::: {.column width="70%"}

*åˆ†ç±»ï¼ˆå‰ï¼‰æ ‡å‡†* ï¼ˆ$d(a,b)$ $a$ å’Œ $b$ ä¹‹é—´çš„è·ç¦»ï¼‰

- Single-linkage: $\min \{ d(a,b):a\in A, b\in B \}$
- Complete-linkage: $\max \{ d(a,b):a\in A, b\in B \}$
- Average-linkage: $\frac{1}{|A||B|}\sum_{a\in A}\sum_{b\in B}d(a,b)$
- Centroid-linkage: $||c_t - c_s||$, where $c_s$ and $c_t$ are the centroids of clusters $s$ and $t$.

:::

::::


## å¸¸è§ Linkages æ¯”è¾ƒ

```{r}
#| label: linkages
#| fig-align: center
#| fig-height: 6

fg_true <- ggplot(iris, aes(Sepal.Length, Sepal.Width, color = Species)) +
  geom_point(alpha = 0.8, size = 5) +
  ggtitle("IRIS: True Species")


data_m <- iris[,-5]

hie_single <- hclust(dist(data_m), method = "single")
dend <- as.dendrogram(hie_single)
dend <- dend %>% set("branches_k_color", k = 3) %>%
  set("branches_lwd", 1.2) %>% 
  set("labels", rep(c("set", "ver", "vir"), each = 50)) %>%
  set("labels_colors", rep(c("red", "green", "blue"), each = 50)) %>%
  set("labels_cex", 0.6)

ggd1 <- as.ggdend(dend)

fg_single <- ggplot(ggd1) +
  ggtitle("Single-Linkage")

hie_complete <- hclust(dist(data_m), method = "complete")
dend <- as.dendrogram(hie_complete)
dend <- dend %>% set("branches_k_color", k = 3) %>%
  set("branches_lwd", 1.2) %>% 
  set("labels", rep(c("set", "ver", "vir"), each = 50)) %>%
  set("labels_colors", rep(c("red", "green", "blue"), each = 50)) %>%
  set("labels_cex", 0.6)

ggd1 <- as.ggdend(dend)

fg_complete <- ggplot(ggd1) +
  ggtitle("Complete-Linkage")


hie_ave <- hclust(dist(data_m), method = "average")
dend <- as.dendrogram(hie_ave)
dend <- dend %>% set("branches_k_color", k = 3) %>% 
  set("branches_lwd", 1.2) %>% 
  set("labels", rep(c("set", "ver", "vir"), each = 50)) %>%
  set("labels_colors", rep(c("red", "green", "blue"), each = 50)) %>%
  set("labels_cex", 0.6)

ggd1 <- as.ggdend(dend)

fg_average <- ggplot(ggd1) +
  ggtitle("Average-Linkage")

fg_true / (fg_single + fg_complete + fg_average)
```

## ä¸‰ç§linkagesçš„ç²¾ç¡®åº¦

```{r}
#| label: linkage-precision
#| fig-align: center
#| fig-height: 6

df_precision <- tibble(
  single = extCriteria(as.integer(iris[, 5]), cutree(hie_single, 3), crit = "Precision")$precision,
  complete = extCriteria(as.integer(iris[, 5]), cutree(hie_complete, 3), crit = "Precision")$precision,
  average = extCriteria(as.integer(iris[, 5]), cutree(hie_ave, 3), crit = "Precision")$precision
) |> pivot_longer(everything(), names_to = "linkage", values_to = "precision")


ggplot(df_precision, aes(x = linkage, y = precision)) +
  geom_point() +
  labs(
    x = "Linkage",
    y = "Precision"
  )

```


## éå±‚æ¬¡èšç±» (Non-hierarchical clustering)

- Centroid-basedï¼š K-means, K-medians, K-medoids, K-modes......
- Model-based: Gaussian, gamma, t, poisson, GMM......
- Density-based
- Grid-based

## èšç±»ä¹‹å‰ï¼šèšå‡ ç±»ï¼Ÿ

::: {.callout-note}

## åŸºæœ¬æ€è·¯

$$
Max(\frac{ç±»å†…ç›¸ä¼¼æ€§}{ç±»é—´ç›¸ä¼¼æ€§}) 
$$

:::

:::: {.columns}

::: {.column width="50%"}

å¸¸è§æ ‡å‡†ï¼š

- Silhouette
- Davies-Bouldin index
- Dunn index

:::

::: {.column width="50%"}

åˆ¤æ–­æ–¹æ³•ï¼š^[ä¸EFAåˆ¤æ–­æ–¹å¼ä¸€æ ·ï¼ˆä¸ºä»€ä¹ˆï¼Ÿï¼‰]

```{r}
#| label: clusterNumber
#| fig-align: center
#| fig-height: 3
#| fig-cap: "5ä¸ªæ˜¯æœ€ä½³çš„é€‰æ‹©ï¼Œä¸è¿‡ä¸ºäº†æ˜¾ç¤ºæ–¹æ³•å·®åˆ«ï¼Œåé¢é‡‡ç”¨3ä¸ª"

library(clusterCrit)

km_res_k <- lapply(2:6, function(i) kmeans(data_example[, .(x, y)], i)$cluster)

db_km <- lapply(km_res_k, function(j) intCriteria(data.matrix(data_example[, .(x, y)]), j, "Davies_bouldin")$davies_bouldin)

ggplot(data.table(K = 2:9, Dav_Boul = unlist(db_km)), aes(K, Dav_Boul)) +
  geom_line() +
  geom_point()
```

:::

::::

## Centroid-based: K-Mean

```{r}
#| label: kmean
#| fig-align: center
#| fig-height: 3

km_res <- kmeans(data_example, 3)$cluster

data_example[, class := as.factor(km_res)]

centroids <- data_example[, .(x = mean(x), y = mean(y)), by = class]

ggplot(data_example, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 8) +
  geom_point(data = centroids, aes(x, y), color = "darkred", shape = "+", size = 25) +
  scale_color_gb()
```

:::: {.columns}

::: {.column .fragment width="50%"}

*æ­¥éª¤*

1. åˆ›å»ºéšæœºçš„Kä¸ªèšç±»ï¼ˆå¹¶è®¡ç®—è´¨å¿ƒï¼‰ã€‚
1. å°†ç‚¹åˆ†é…ç»™æœ€è¿‘çš„è´¨å¿ƒã€‚
1. æ›´æ–°è´¨å¿ƒã€‚
1. å½“è´¨å¿ƒä»åœ¨å˜åŒ–æ—¶ï¼Œè¿”å›æ­¥éª¤2ã€‚


:::

::: {.column .fragment width="50%"}

ä¼˜ç‚¹ï¼šè®¡ç®—é€Ÿåº¦å¿«ã€‚æ˜“äºç†è§£

ç¼ºç‚¹ï¼š

- åˆå§‹å€¼æ•æ„Ÿ
- é‡çº²æ•æ„Ÿ
- åªèƒ½åˆ›å»ºå‡¸å½¢èšç±»
- å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ

:::

::::

## Centroid-based: K-medoids

:::: {.columns}

::: {.column width="50%"}

ä½¿ç”¨ä¸­å¿ƒç‚¹è€Œéå¹³å‡å€¼

*ä¼˜ç‚¹*

- å¯¹å¼‚å¸¸å€¼ä¸å¤ªæ•æ„Ÿ
- å¯ä»¥ä½¿ç”¨ä»»ä½•è·ç¦»åº¦é‡

:::

::: {.column width="50%"}

*ç¼ºç‚¹*

- åˆå§‹å€¼æ•æ„Ÿ
- é‡çº²æ•æ„Ÿ
- æ¯”K-meansç®—æ³•æ…¢

:::

::::

```{r}
#| label: kmedoids
#| fig-align: center
#| fig-height: 3

kmed_res <- pam(data_example[, .(x, y)], 3)
data_example[, class := as.factor(kmed_res$clustering)]

medoids <- data.table(kmed_res$medoids, class = as.factor(1:3))

ggplot(data_example, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 8) +
  scale_color_gb() +
  geom_point(data = medoids, aes(x, y), color = "darkred", size = 11)
```

::: {.notes}

Medoids: the one that minimizes the total distance to all other pointsï¼Œa real one not a calculated mean

:::

## Centroid-like: Spectral Clustering

åŸºäºè°±åˆ†è§£ï¼ˆspectral decompositionï¼‰æå–æ•°æ®ç‰¹å¾ï¼Œç„¶åæ ¹æ®ç‰¹å¾èšç±»ã€‚^[è™½ç„¶ä½¿ç”¨åˆ°äº†k-meanï¼Œä½†ä¹‹å‰æ­¥éª¤å¯¼è‡´ä¸¤ç§æ–¹æ³•çš„æ•°å­¦åŸºç¡€æœ‰æœ¬è´¨ä¸åŒã€‚]

æ­¥éª¤ï¼š

1. N = æ•°æ®æ•°é‡ï¼Œd = æ•°æ®ç»´åº¦ï¼Œ
2. $\mathbf{A}$ = ç›¸ä¼¼åº¦çŸ©é˜µï¼Œ$A_{ij} = \exp(- (data_i - data_j)^2 / (2*\sigma^2) )$ - N Ã— NçŸ©é˜µï¼Œ
3. $\mathbf{D}$ = å¯¹è§’çŸ©é˜µï¼Œå…¶(i,i)å…ƒç´ æ˜¯$\mathbf{A}$ç¬¬iè¡Œå…ƒç´ ä¹‹å’Œ - N Ã— NçŸ©é˜µï¼Œ
4. $\mathbf{L}$ = $\mathbf{D}^{-1/2} \mathbf{A} \mathbf{D}^{-1/2}$ - N Ã— NçŸ©é˜µï¼Œ
5. $\mathbf{X}$ = $\mathbf{L}$çš„kä¸ªæœ€å¤§ç‰¹å¾å‘é‡çš„é›†åˆ - N Ã— kçŸ©é˜µï¼Œ
6. å°†$\mathbf{X}$çš„æ¯ä¸€è¡Œå½’ä¸€åŒ–ä¸ºå•ä½é•¿åº¦ - N Ã— kçŸ©é˜µï¼Œ
7. åœ¨$\mathbf{X}$ä¸Šè¿è¡ŒK-meansç®—æ³•ã€‚

## è°±èšç±»æ•ˆæœ

```{r}
#| label: spectral
#| fig-align: center
#| fig-height: 6

data_spiral <- rio::import("https://drhuyue.site:10002/sammo3182/data/sna_spiral.csv")

fg_spiral <- ggplot(data_spiral, aes(x, y)) +
  geom_point(size = 2)

res <- specc(data.matrix(select(data_spiral, x, y)), centers = 3)

data_spiral <- data.table(data_spiral)
data_spiral[, class := as.factor(res)]

fg_spectral <- ggplot(data_spiral, aes(x, y, color = class, shape = class)) +
  geom_point(size = 2) +
  scale_color_gb() +
  ggtitle("Spectral Clustering")

fg_spiral + fg_spectral
```


## Model-based: GMM

é€šå¸¸å¯¹äºå¤šç»´æ•°æ®é‡‡ç”¨Mixture of models, æ¯”å¦‚Gaussian Mixture Models (GMM)

$$
L(\boldsymbol{\mu_1}, \dots, \boldsymbol{\mu_k}, \boldsymbol{\Sigma_1}, \dots, \boldsymbol{\Sigma_k} | \boldsymbol{x_1}, \dots, \boldsymbol{x_n}).
$$

::: {.notes}

Cluster: mean ($\mathbf{\mu}$) and covariance matrix ($\mathbf{\Sigma}$)
Here, cluster is represented by . So not just centroid as in the case of K-means.

:::

::: {.fragment}

ç±»æ•°é€‰æ‹©ï¼šBIC

```{r}
#| label: bic
#| fig-align: center
#| fig-height: 3
#| 
res <- Mclust(data_example[, .(x, y)], G = 2:6, modelNames = c("VVV", "EEE", "VII", "EII"), verbose = FALSE)

plot(res, what = "BIC")

```

:::


## æ“ä½œè¿‡ç¨‹

- ç›®æ ‡ï¼šMaximum likelihood
- è¿‡ç¨‹ï¼šExpectation Maximization (EM)

```{r}
#| label: gmm
#| fig-align: center
#| fig-height: 5

plot(res, what = "classification")
```

## Density-based æ–¹æ³•

å®šä¹‰å¯†åº¦ï¼Œç„¶åå¯»æ‰¾æœ€å¤§åŒ–å¯†åº¦çš„ç‚¹

:::: {.columns}

::: {.column width="50%"}

å¸¸è§æ–¹æ³•:

- DBSCAN: ç”¨neighborhoodå®šä¹‰å¯†åº¦ï¼Œæ‰€æœ‰ç‚¹å¿…é¡»åœ¨ä¸€å®šè·ç¦»å†…ï¼Œæ¯ä¸ªclusteré‡Œå¿…é¡»æœ‰ä¸€å®šæ•°é‡çš„ç‚¹^[æœªä¸ä»»ä½•clusterè¿æ¥ä¸”æœªé€šè¿‡æœ€å°ç‚¹æ ‡å‡†çš„ç‚¹è¢«æ ‡è®°ä¸ºå™ªå£°ï¼ˆå¼‚å¸¸å€¼ï¼‰]
- OPTICS
- HDBSCAN
- Multiple densities (Multi-density) methods


:::

::: {.column width="50%"}

*ä¼˜ç‚¹*

- è‡ªåŠ¨æå–å¼‚å¸¸å€¼
- è®¡ç®—é€Ÿåº¦å¿«
- å¯ä»¥æ‰¾åˆ°ä»»æ„å½¢çŠ¶çš„ç°‡
- æ ¹æ®æ•°æ®[è‡ªåŠ¨ç¡®å®šç°‡çš„æ•°é‡]{.red}

*ç¼ºç‚¹*

- å¿…é¡»é¢„è®¾å‚æ•°ï¼ˆ$\epsilon$ï¼ŒminPtsï¼‰å€¼
- é‚»åŸŸå¯èƒ½å­˜åœ¨è¿æ¥é—®é¢˜

:::

::::

## DBSCANæ•ˆæœ

```{r}
#| label: dbscan
#| fig-align: center
#| fig-height: 6

res <- dbscan(data_example[, .(x, y)], eps = 0.4, minPts = 5)

data_example[, class := as.factor(res$cluster)]

ggplot(data_example, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 8) +
  scale_color_gb(palette = "digitMixed")
```

## DBSCANä¼˜åŠ¿

```{r}
#| label: banana
#| fig-align: center
#| fig-height: 6

bananas <- rio::import("https://drhuyue.site:10002/sammo3182/data/sna_banana.dat")
db_res <- dbscan(bananas, eps = 10, minPts = 15)

data_all <- data.table(bananas, class = as.factor(db_res$cluster))

fg_raw <- ggplot(data_all, aes(V1, V2)) +
  geom_point(alpha = 0.75)

km_res <- kmeans(bananas, 9)
data_all[, class := as.factor(km_res$cluster)]

fg_kmean <- ggplot(data_all, aes(V1, V2, color = class)) +
  geom_point(alpha = 0.75) +
  ggtitle("K-Mean Result")

data_all <- data.table(bananas, class = as.factor(db_res$cluster))

fg_dbscan <- ggplot(data_all, aes(V1, V2, color = class)) +
  geom_point(alpha = 0.75) +
  ggtitle("DBSCAN Result")

fg_raw / (fg_kmean + fg_dbscan)

```

## DBSCAN vs. Spectral

```{r}
#| label: spectralVSdbscan
#| fig-align: center
#| fig-height: 6

data_compound <- rio::import("https://drhuyue.site:10002/sammo3182/data/sna_compound.csv")

fg_compound <- ggplot(data_compound, aes(x, y, color = as.factor(label))) +
  geom_point(size = 2) +
  ggtitle("çœŸå®åˆ†ç±»")

res <- specc(data.matrix(select(data_compound, x, y)), centers = 6)

df_spectral <- data_compound |> 
  mutate(class = as.factor(res))

fg_spectral <- ggplot(df_spectral, aes(x, y, color = class)) +
  geom_point(size = 2) +
  ggtitle("Spectral")

db_res <- dbscan(data.matrix(select(data_compound, x, y)), eps = 1.4, minPts = 5)

df_dbscan <- data_compound |> 
  mutate(class = as.factor(db_res$cluster))

fg_dbscan <- ggplot(df_dbscan, aes(x, y, color = class)) +
  geom_point(size = 2) +
  ggtitle("DBSCAN")

fg_compound / (fg_spectral + fg_dbscan)
```

## åˆå§‹å€¼å½±å“DBSCANæ•ˆæœï¼ˆäº¤å æ•°æ®èšç±»ï¼‰

```{r}
#| label: dbscan_parameter
#| fig-align: center
#| fig-height: 6

data_connected <- as.data.table(cbind(
  rbind(
  MASS::mvrnorm(220, mu = c(3.48, 3.4), Sigma = matrix(c(0.005, -0.015, -0.01, 0.09), nrow = 2)),
  MASS::mvrnorm(280, mu = c(3.8, 3.8), Sigma = matrix(c(0.05, 0, 0, 0.05), nrow = 2)),
  MASS::mvrnorm(220, mu = c(3.85, 2.9), Sigma = matrix(c( 0.1, 0.03, 0.03, 0.017), nrow = 2))
  ), 
  c(
    rep(1, 220), rep(2, 280), rep(3,220)
  )
))

setnames(data_connected, c("V1", "V2", "V3"), c("x", "y", "label"))

fg_true <- ggplot(data_connected, aes(x, y, color = as.factor(label))) +
  geom_point(alpha = 0.75, size = 2) +
  scale_color_gb() +
  ggtitle("çœŸå®æ•°æ®")

db_res <- dbscan(data_connected, eps = 0.08, minPts = 18)

data_all <- data.table(data_connected, class = as.factor(db_res$cluster))

fg_goodset <- ggplot(data_all, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 2) +
  ggtitle("DBSCAN(minPts = 18)")

db_res <- dbscan(data_connected, eps = 0.08, minPts = 10)

data_all <- data.table(data_connected, class = as.factor(db_res$cluster))

fg_badset <- ggplot(data_all, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 2) +
  ggtitle("DBSCAN(minPts = 10)")

fg_true / (fg_goodset + fg_badset)
```

## æ–¹æ³•å¯¹æ¯”

```{r}
#| label: cluster_compare
#| fig-align: center
#| fig-height: 6

km_res <- kmeans(data_connected, 3)

df_kmean <- mutate(data_all, class = as.factor(km_res$cluster))

fg_kmean <- ggplot(df_kmean, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 2) +
  ggtitle("K-mean")

m_res <- Mclust(data_connected[, .(x, y)], G = 3, modelNames = "VVV", verbose = FALSE)

df_gmm <- mutate(data_all, class = as.factor(m_res$classification))

fg_gmm <- ggplot(df_gmm, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 2)  +
  ggtitle("GMM")

res <- specc(data.matrix(data_connected[, .(x, y)]), centers = 3)

df_spectral <- mutate(data_all, class = as.factor(res))

fg_spectral <- ggplot(df_spectral, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 2)  +
  ggtitle("Spectral")

(fg_kmean + fg_spectral) / (fg_goodset + fg_gmm)
```

## èšç±»é™¤äº†èšç±»ä»¥å¤–çš„åŠŸèƒ½

::: {.r-stack}

```{r}
#| label: anomaly
#| fig-align: center
#| fig-height: 6
#| fig-cap: "ç”„åˆ«å¼‚å¸¸å€¼"

anom <- c(rep(1, 30), rep(0, 3))
data_example[, class := as.factor(anom)]
levels(data_example$class) <- c("Anomaly", "Normal")

ggplot(data_example, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 8) +
  scale_color_gb()
```

::: {.fragment}

```{r}
#| label: compression
#| fig-align: center
#| fig-height: 6
#| fig-cap-location: top
#| fig-cap: "æ•°æ®æµ“ç¼©/é™ç»´"
#| eval: true

kmed_res <- pam(data_example, 3)$clustering
data_example <- mutate(data_example, class = as.factor(kmed_res))

centroids <- data_example[, .(x = mean(x), y = mean(y)), by = class]

ggplot(data_example, aes(x, y, color = class)) +
  geom_point(alpha = 0.75, size = 8) +
  scale_color_gb() +
  geom_point(data = centroids, aes(x, y), color = "darkred", shape = "+", size = 18)
```



:::

:::

# é™„å½•ï¼šå…¨ç½‘åˆ†æ  {.appendix}

## CUG

"Baseline network"æ¯”è¾ƒåˆ†æçš„ä¸€ç§

1. å›ºå®šå±æ€§ (size, prob of edges, dyad census, degree, # of triangles, etc.)
1. åŒç­‰å¯èƒ½


```{r}
#| label: cug
#| fig-align: center
#| fig-height: 4

rand.gr <- rgraph(n = 20, m = 1000, tprob = 0.3)
plot(density(gden(rand.gr)))
```

:::{.notes}

æ ¹æ®ç‰¹å®šå±æ€§é€šè¿‡bernoulliåˆ†å¸ƒå»ºç«‹éšæœºç½‘ç»œï¼Œæ‰€æœ‰ç½‘ç»œéƒ½æ˜¯è¢«è§†ä¸ºåŒç­‰å¯èƒ½å‡ºç°

- n: The size of the vertex set (|V(G)|) for the random graphs
- m: The number of graphs to generate
- tprob: Information regarding tie (edge) probabilities; see below

Generating 1000 random graphs of size 20; assumes digraph. tprob, probability of any tie existing is 30%. Plotting the density. it is probability, so, some is before 0.3, some beyond 0.3

:::



## H<sub>0</sub>

$$
Network_{obs}\quad vs.\quad Network_{ran}
$$

:::{style="text-align:center"}
è§‚æµ‹ç½‘ç»œä¸éšæœºç½‘ç»œåœ¨è¿™äº›æ–¹é¢æ˜¯å¦ç›¸å¼‚
:::

![](https://drhuyue.site:10002/sammo3182/figure/sna_networkHypothesis.png){height=450 fig-align="center"}

## Conditional Uniform Graph Test

::: {.r-stack}

```{r}
#| label: cugDensity
#| fig-align: center
#| fig-cap: Density

data(emon)
g <- emon$Cheyenne

## Density 
cug.test(g, gden, mode="digraph", cmode="size", reps=1000) %>% 
  plot.cug.test()
```

::: {.fragment}

```{r}
#| label: cugReciprocity
#| fig-align: center
#| fig-cap: Density

## Reciprocity
cug.test(g, grecip, mode="digraph", cmode="size", reps=1000) %>% 
  plot.cug.test()
```

:::

::: {.fragment}

```{r}
#| label: cugEdge
#| fig-align: center
#| fig-cap: Edge

### Controlling the number of edges & size
cug.test(g, grecip, mode="digraph", cmode="edges", reps=1000) %>% 
  plot.cug.test()
```

:::

::: {.fragment}

```{r}
#| label: cugDyad
#| fig-align: center
#| fig-cap: Dyad Census

### Controlling the dyad census
cug.test(g, grecip, mode="digraph", cmode="dyad.census", reps=1000) %>% 
  plot.cug.test()
```

:::

:::

:::{.notes}

Drabek et al. (1981) provide seven case studies of emergent multi-organizational networks (EMONs) in the context of search and rescue (SAR) activities. Networks of interaction frequency are reported, along with several organizational attributes.

Drabekç­‰äººï¼ˆ1981å¹´ï¼‰æä¾›äº†ä¸ƒä¸ªå…³äºæœæ•‘ï¼ˆSARï¼‰æ´»åŠ¨ä¸­æ¶Œç°çš„å¤šç»„ç»‡ç½‘ç»œï¼ˆEMONsï¼‰çš„æ¡ˆä¾‹ç ”ç©¶ã€‚æŠ¥å‘Šäº†äº’åŠ¨é¢‘ç‡ç½‘ç»œï¼Œä»¥åŠå‡ ä¸ªç»„ç»‡å±æ€§ã€‚

:::


## QAP

::::{.columns style="text-align:center"}

:::{.column width="50%"}

- åˆ›å»ºéšæœºç½‘ç»œåˆ†å¸ƒ (= CUG)
- æ§åˆ¶ç½‘ç»œç»“æ„ (&ne; CUG)

:::{.notes}

ç½‘ç»œç»“æ„: centrality ç­‰

non-parametricï¼Œä»sampleä¸­æŠ½å‡ºä¸¤ç»„ï¼Œå¯¹æ¯”statsï¼Œçœ‹æ˜¯å¦ä¸€æ ·ã€‚
ä¸t-testç­‰çš„å¯¹æ¯”é‡è¦ä¸åŒåœ¨äºä¸æ˜¯è·Ÿnormalæ¯”

:::

:::


:::{.column width="50%" .fragment}

é€šè¿‡permutation testå®ç°:

1. è®¡ç®—åŸå§‹ç½‘ç»œçš„correlation coefficient;^[Pearson's r correlation or Euclidean distance]
1. Permuteä¸€äº›verticesï¼›
1. å°†Permuted ç½‘ç»œå’ŒåŸå§‹ç½‘ç»œç›¸å¯¹æ¯”ï¼›
1. ä¸€é¡¿ç‹‚Permute + ç‹‚æ¯”
1. çœ‹çœ‹correlationçš„åˆ†å¸ƒ
1. ç¡®å®šç‰¹å®šå€¼å’ŒåŸå§‹ç½‘ç»œç›¸åŒçš„æ¦‚ç‡

:::{.notes}

ç½‘ç»œcorrelation æ ¹æ®ä¸¤ç‚¹é™¤ç›¸äº’è¿æ¥å¤–çš„å…¶ä»–degree (remaining degree)è®¡ç®—

:::

:::

::::


## å¤šå…ƒç½‘ç»œåˆ†æ (QAP)

OV: ç½‘ç»œ   
EV: è§£é‡Šå˜é‡adjacency matrices

$$
E(\text{Advice}_{ij}) = \beta_0 + \beta_1\text{Reports}_{ij} + \beta_2\text{Friends}_{ij} +...
$$


:::{.fragment}

```{r}
#| label: regData
#| echo: false

reports <- read.csv("data/reports.csv")
reports <- reports[, -1]
friends <- read.csv("data/friends.csv", row.names = "ID")
advice <- read.csv("data/advice.csv", row.names = "ID")
```

```{r}
#| label: netReg

qap_reg <- netlogit(advice, list(friends, reports), nullhyp = "qap", reps = 10)
summary(qap_reg)
```

:::

:::{.notes}

There are also `netlm` etc.

Not 10, often over 1000

null hyp choices: qap quick, qapspp robust

:::


## ERGMæ²¿é©

::: {.large style="text-align:center; margin-top: 2em"}

Simple Random Graph Model

&darr;

P<sup>1</sup> Model

&darr;

P<sup>*</sup> Model

&darr;

ERGM &rarr GEGM/TEGM...

:::

## Simple Random Graph Model

$$
P(X = x) = \frac{exp(\theta_LL(x))}{k(\theta)}.
$$

+ L: # of arcs
+ &theta;: edge parameter^[k(&theta;)æ„åœ¨æ ‡å‡†åŒ–, æ•´ä¸ªç»“æœå’Œä¸º1ã€‚]

:::{.notes}

1959ï¼Œåªå…è®¸specify links

:::

::: {.callout-important .fragment}

## Bernoulli Assumption

+ Tie æ˜¯ç‹¬ç«‹çš„ï¼ˆğŸ¤¨ï¼‰
+ IID ties &rarr; Log-probability of a graph is proportional to a weighted sum of edge-count

:::

:::{.notes}

åŸºäºè¿™ä¸ªassumptionæ‰æœ‰simple random graph

:::

## P<sup>1</sup> Model

$$
P(X = x) = \frac{exp(\theta_LL(x) + \color{red}{\theta_MM(x) + \sum_i\alpha_iy_{i+} + \sum_j\beta_iy_{+j}})}{\kappa(\theta)}.
$$

+ M: # of mutual
+ y<sub>i+</sub>: # outgoing ties
+ y<sub>+j</sub>: # incoming ties

::: {.callout-important .fragment}

## ~~Bernoulli~~ Dyad Independence Assumption

+ å…è®¸äº’æƒ å’Œä¸åŒæ–¹å‘çš„ä¸åŒä½œç”¨
+ ç”¨äºbinary,æœ‰å‘ç½‘ç»œ

:::{.notes}

+ Allows for reciprocity and differential attractiveness
+ Useful for binary, directed graphs

:::

:::

:::{.notes}

æ‰€æœ‰é«˜äºdegree of reciprocityçš„æ€§è´¨éƒ½ä¸èƒ½è§£å†³, æ²¡äººå†ç”¨

:::

## P<sup>*</sup> Model

$$
P(X = x) = \frac{exp(\sum_i\theta_i\color{red}{z_i(x)})}{\kappa(\theta)}.
$$

z<sub>i</sub>: any network statisticsåŠ åœ¨ä¸€èµ·

::: {.callout-important .fragment}

## ~~Dyad Independence~~ Markov assumption

+ Ties are (conditionally) independent unless they [share]{.red} a node.
    + Parallels in Markov chains, time series, spatial analysis
+ Think of nodes as [connecting]{.red} edges to obtain this dependence structure
+ Ties are conditionally dependent if and only if they [share]{.red} a node

:::

:::{.notes}

ERGMåŸºäºæ­¤å‘å±•è€Œæ¥ï¼Œç°åœ¨ä¸¤è€…åŒºåˆ«æ›´å¤šæ˜¯computationalè€Œéæƒ³æ³•ä¸Šçš„

:::

## Network Statistics

::::{.columns style="text-align:center"}

:::{.column width="50%"}

![](https://drhuyue.site:10002/sammo3182/figure/sna_pStarParameters.jpg){height=600 fig-align="center"}

:::

:::{.column width="50%"}

![](https://drhuyue.site:10002/sammo3182/figure/sna_pStarParametersII.jpg){height=600 fig-align="center"}


:::{.notes}

Things one can test in P*, path closure: å¤šé‡triangle

ç®—èµ·æ¥æ›´éº»çƒ¦ï¼Œ necessary 

å¦‚æœä½ æƒ³äº†è§£æ›´å¤š

```{r}
#| label: ergmR
#| eval: false

library(ergm)

?ergm.terms

search.ergmTerms(keyword = "triangle")
```

GOOGLEä¸Šæ²¡æœ‰å…¨çš„è¡¨

:::

:::

::::


## ç†è§£ERGMç»“æœ

$$
P(N, \boldsymbol{\theta}) = \frac{exp(\boldsymbol{\theta'h}(N))}{\sum_{N^*\in N}exp(\boldsymbol{\theta'h}(N^*))}.
$$

- Network levelï¼š[exp(&theta;)]{.red}ï¼Œrelative likelihood of observing N<sup>i+</sup> to observing N<sup>i-</sup>

:::{.notes}

å¢åŠ ä¸€ä¸ªnetwork statistics æ¯”ä¸åŠ å®ƒå˜åŒ–çš„likelihood

odd-like stuff: é‚£ä¹ˆ &theta; = 0ä»£è¡¨ä»€ä¹ˆï¼Ÿ

&theta; = 0 &rArr; exp(&theta;) = 1 &rArr; å¢åŠ æˆ–ä¸å¢åŠ è¿™ä¸ªstatsçœ‹åˆ°observed networkå‡ ç‡æ˜¯ä¸€æ ·çš„ï¼Œa.k.a., æ²¡ç”¨

:::

- Edge levelï¼š[exp(&theta;<sub>r</sub>&delta;<sub>r</sub><sup>(ij)</sup>)]{.red}, P(N<sub>ij</sub> = 1|N<sub>-ij</sub>, &theta;) = logit<sup>-1</sup>&sum;<sub>r=1</sub>&theta;<sub>r</sub>&delta;<sub>r</sub><sup>(ij)</sup>(N)

:::{.notes}

&delta;<sub>r</sub><sup>(ij)</sup>: Change parameter

è®°å½•æ”¹å˜å¤šå°‘ï¼š æ¯”å¦‚åŒæ ·æ˜¯å¢åŠ ä¸€ä¸ªedgeï¼Œå¯¹äºmutualï¼ˆåŒ…å«reciprocalå’Œnot conntectedï¼‰ï¼Œå¯¹äºi å’Œ jå·²ç»ç›¸è¿çš„æƒ…å†µï¼ŒåŠ ä¸€ä¸ªedgeæ˜¯å¢åŠ äº†ä¸€ä¸ªmutualï¼Œé‚£ä¹ˆ&delta; + 1, ä½†å¦‚æœi å’Œ jä¸ç›¸è¿ï¼Œé‚£ä¹ˆåŠ ä¸€ä¸ªedgeï¼Œæ˜¯æŠŠä¸€ä¸ªäº’ä¸ç›¸è¿çš„mutualå¼„æ²¡äº†ï¼Œ&delta; - 1ã€‚ æ‰€ä»¥å®é™…è®¡ç®—æ¯”è¾ƒå¤æ‚ï¼Œä½†btergm::interpret

$logit^{-1} = frac{1}{1 + e^{-1}}$

:::

- Nodal level: Block-wise conditional distributions

:::{.notes}

Blocks are split according to an attribute, complicated

:::

## è·‘å®Œä¸ç®—å®Œ

::::{.columns style="text-align:center; margin-top: 2em"}

:::{.column width="30%" .fragment}

*è¯Šæ–­*

- Convergence
- Degeneracy

[Super important!]{.fragment .highlight-red}

:::{.notes}

Degenracy is ERGM goodness of fit, unstable results, random process, model fit, little changes a lot; leading to prediction that everyone should connect to everyone or none

Looking for high p-value (not violate the assumptions)

Convergence is for Markov Chain

:::

:::

:::{.column width="40%" .fragment}

*å±€é™*

1. MPLE vs. MLE vs. MCMC-MLE
1. Degeneracy
1. Sensitivity to missing data

:::{.notes}

1. Maximum pseudo LEï¼› å‰ä¸¤ä¸ªå¯¹P1ä¹‹å‰è¿˜å¥½ï¼Œä¹‹åç®—ä¸å‡ºæ¥

Theory really matters!! æ¥è§£é‡Šè¦åŠ ä»€ä¹ˆnetwork statistics

æ€ä¹ˆè§£å†³ geometrically weighted degree distribution

1. Sensitivity

:::

:::


:::{.column width="30%" .fragment}

*å‘å±•*

+ GERGM
+ TERGM
    + STERGM
+ FERGM

......

:::

:::{.notes}

G ERGM: weighted ergm

S TERGM: Network panel data, Separable TERGM for each time point the ties formatting and disoluting independently

F ERGM: Frailty ERGM "individual-level random effects" for the propensity for a directed tie

:::

::::


## Network analysis &#129309; Spatial Analysis

Modeling Peer Influence

\begin{align}
\boldsymbol{Y}^{(1)} &= \boldsymbol{XB},\\
\boldsymbol{Y}^{(t)} &= \alpha\boldsymbol{WY}^{t} + (1 - \alpha) Y^{(1)}.
\end{align}


- **Y**<sup>(1)</sup>: Nä¸ªäººï¼Œæ¯äººå¯¹Mä¸ªé—®é¢˜çš„[åˆå§‹]{.red}çœ‹æ³• (N &times; M); 
- **X**: Kä¸ªä¼šå½±å“ä¸ªä½“çœ‹æ³•çš„ï¼ˆ[å¤–ç”Ÿæ€§]{.red}ï¼‰å˜é‡ï¼ˆN &times; Kï¼‰;
- &alpha;: ï¼ˆå†…ç”Ÿæ€§çš„ï¼‰äººé™…å½±å“å¯¹Yçš„ä½œç”¨çš„[æ¯”é‡]{.red};
- **W**: [äººé™…å…³ç³»çŸ©é˜µ]{.red}ï¼ˆN &times; N).

