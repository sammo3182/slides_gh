---
title: "æ½œå˜é‡åˆ†æï¼ˆåŸºç¡€ç¯‡ï¼‰"
subtitle: "æ”¿åŠ¡å¤§æ•°æ®åº”ç”¨ä¸åˆ†æ (80700673)"
author: "èƒ¡æ‚¦"
institute: "æ¸…åå¤§å­¦" 
knitr: 
    opts_chunk: 
      echo: false
format: 
  revealjs:
    css: https://www.drhuyue.site/slides_gh/css/style_basic.css
    theme: ../../../css/goldenBlack.scss
    slide-number: true
    incremental: true
    preview-links: true # open an iframe for a link
    link-external-newwindow: true
    self-contained: false
    chalkboard: false # allwoing chalk board B, notes canvas C
    # callout-icon: false
    show-slide-number: all # `speaker` only print in pdf, `all` shows all the time
    title-slide-attributes:
      data-background-image: https://gitlab.com/sammo3182/backup/raw/85b3c1ad4b459d7a9f901f124b936428eda5fcaf/logo_THPS.png?inline=true
      data-background-size: 250px   
      data-background-position: top 10% right 5%
    default-image-extension: png
revealjs-plugins:
  - spotlight
lightbox: 
  match: auto
  effect: fade
spotlight:
  size: 50
  presentingCursor: default
  toggleSpotlightOnMouseDown: false
  spotlightOnKeyPressAndHold: 73 # keycode for "i"
editor_options: 
  chunk_output_type: console
---

```{r setup}
#| include = FALSE

library(pacman)

p_load(psych,
       lavaan,
       semPlot,
       qgraph,
       haven,
       here,
       corrplot,
       tidyverse)

# Functions preload
set.seed(313)

theme_set(
  theme_minimal(base_size = 18)
)

theme_update(
  plot.title = element_text(size = 18), 
  axis.title = element_text(size = 22), 
  axis.text = element_text(size = 18)
)
```

## æ¦‚è¦

:::: {.columns}

::: {.column width="50%"}

1. æ¦‚å¿µä¸åˆ†æé€»è¾‘
    - ä»€ä¹ˆæ˜¯æ½œå˜é‡
    - æ€ä¹ˆåˆ†æ
1. æ¢ç´¢æ€§å› å­åˆ†æ
1. éªŒè¯æ€§å› å­åˆ†æï¼ˆä¸ç»“æ„æ–¹ç¨‹æ¨¡å‹ï¼‰

:::

::: {.column .fragment .nonincremental width="50%"}
**æ“ä½œè¯­è¨€**

* R
    + [`psych`](https://personality-project.org/r/psych/vignettes/intro.pdf)
    + [`laavan`](https://lavaan.ugent.be/)
:::

::::



# æ½œå˜é‡æ¦‚å¿µä¸åˆ†æé€»è¾‘


## æ½œåœ¨å˜é‡ (Latent variables)

:::{.r-hstack}

![](https://drhuyue.site:10002/sammo3182/figure/lv_angry.jpg){fig-align="center" height=600}

![](https://drhuyue.site:10002/sammo3182/figure/lv_happy.jpg){.fragment fig-align="center" height=600}

:::



## Why bother

:::{.r-stack}
![Liberty leading the people](https://drhuyue.site:10002/sammo3182/figure/lv_liberty.jpg){fig-align="center" height=600}

![æˆ˜ç‹¼II](https://drhuyue.site:10002/sammo3182/figure/lv_patriotism.webp){.fragment fig-align="center" height=600}
:::


---

> Latent variable analysis is the [cornerstone]{.red} of successful scientific inquiry.^[Delli Carpini, M. X., and S. Keeter. 1993. â€œMeasuring Political Knowledge: Putting First Things First.â€ *American Journal of Political Science* 37 (4): 1179â€“1206.]


:::: {.columns}

::: {.column width="30%"}
æ¶µç›–æ‰€æœ‰ç¤¾ä¼šç§‘å­¦å­¦ç§‘

* æŠ½è±¡
* å¤æ‚
* ç»¼åˆ


:::

::: {.column .fragment width="30%"}
1. ä¸å¯è§(Unobservable)
1. å¤šç»´åº¦(Multidimensional)
1. æœ‰æ•ˆæœ(Consequential)


:::{.notes}
å…œé‡Œæœ‰å¤šå°‘é’±ï¼Œä¸å¯è§ï¼Œä½†ç»´åº¦å•ä¸€ï¼Œä¸å®œç”¨æ½œå˜é‡åˆ†æï¼Œæ›´å¥½çš„åŠæ³•æ˜¯ç¿»å…œ

The latent variable per se can't be directly measured. But its consequences in opinions and behaviors can be observed.
:::

:::

::: {.column width="40%"}
![](https://drhuyue.site:10002/sammo3182/figure/lv_jamesStimson.jpg){.fragment fig-align="center" height=400}

:::{.notes}
Jaes Stimson (1991), University of North Carolina at Chapel Hill
:::
:::

::::



## åˆ†æé€»è¾‘ï¼š

:::{style="text-align:center; margin-top: 2em"}
ç»“æœ [&larr;]{.red} å…±å› 
:::

:::{.notes}
çˆ±ç¼˜å–ï¼Œå–ç¼˜æœ‰ï¼Œæœ‰ç¼˜ç”Ÿï¼Œç”Ÿç¼˜è€æ­»
:::

ğŸŒ° ä¸ªä½“çš„ç¤¾ä¼šèµ„æœ¬ï¼ˆsocial capitalï¼‰

:::{.notes}
Three dimensions of social capital:

1. Trust
1. Norms
1. Networks
:::

:::{.fragment .nonincremental style="text-align:center; margin-top: 2em"}
æŒ‡æ ‡é—®é¢˜ï¼ˆ1~10ï¼‰ï¼š

1. æ‚¨æ˜¯å¦ä¿¡ä»»èº«è¾¹äººï¼Ÿ
1. æ‚¨åœ¨æ”¿åºœæœºå…³æœ‰æ²¡æœ‰äº²æˆšï¼Ÿ
1. æ‚¨çš„æœ‹å‹æ˜¯å¦å’Œæ‚¨çš„æƒ³æ³•ç»å¸¸ä¸€è‡´ï¼Ÿ
:::


## æµ‹é‡ç¤¾ä¼šèµ„æœ¬

:::: {.columns}

::: {.column width="50%"}
ç´¯åŠ ç»¼åˆæ³•(additive scales)

$$\tilde{X} = (X_1 + X_2 + X_3)/3.$$
:::

::: {.column .fragment width="50%"}
*æ½œåœ¨é—®é¢˜*

1. å¹³ç­‰æƒé‡(equal weight)
1. æ•°æ®æ•æ„Ÿ(extreme value sensitivity)
1. å¿½ç•¥æåŒ–(polarity ignoring)
:::

::::

:::{.fragment .large style="text-align:center; margin-top: 2em"}
*å¦‚ä½•åšå¾—æ›´å¥½ï¼Ÿ*
:::


## å› å­åˆ†æåŸºæœ¬æ¨¡å‹

:::: {.columns}

::: {.column width="50%"}
**å› ç´ åˆ†ææ¨¡å‹(Factorial Models)**

1. æ¢ç´¢æ€§å› å­åˆ†æ(EFA)
1. éªŒè¯æ€§å› å­åˆ†æ(CFA)
1. ç»“æ„æ–¹ç¨‹æ¨¡å‹(SEM)
:::

::: {.column width="50%"}
**ç±»å‹åˆ†ææ¨¡å‹(Topological Models)**

1. é¡¹ç›®ååº”ç†è®º(IRT)
1. MRP
1. è·¨ç¾¤ç»„é¡¹ç›®ååº”(GIRT, DCPO)
:::

::::


# å› å­åˆ†æ


## åŸºæœ¬åŸç†

:::{style="text-align:center"}
ç»“æœ [&larr;]{.red} å…±å› 

&uArr;

å¯è§æŒ‡æ ‡(indicators) [&larr;]{.red} æ½œåœ¨å˜é‡
:::

:::{.fragment style="text-align:center"}
&uArr;

![Minimum factors for the variances](https://drhuyue.site:10002/sammo3182/figure/lv_jiangwei.jpg){fig-align="center" height=300}
:::

:::{.notes}
determine the minimum number of hypothetical factors or components that account for the variance between variables.
:::


## æ“ä½œæŒ‘æˆ˜

:::: {.columns}

::: {.column width="60%"}

![](https://drhuyue.site:10002/sammo3182/figure/lv_efa.png){fig-align="center" height=600}
:::

::: {.column width="40%"}
- **ç›®æ ‡**
  - I wanna fewer dimensons
- **æŒ‘æˆ˜**: 
    - é™åˆ°å‡ ç»´
      - ä¸€ç»´æ˜¯æ˜¯ä¸æ˜¯æœ€ä¼˜é€‰æ‹©
    - å¦‚ä½•é™ç»´
      - å¦‚ä½•å…‹æœâ€œç´¯åŠ ç»¼åˆæ³•â€ç¼ºé™·
    
::: {.fragment .r-fit-text}
*Exploratory* FA
:::

:::
::::


## æ¢ç´¢å¼å› å­åˆ†æ

:::{.callout-important}
## æ ¹æœ¬å…¬å¼

$$X^* = \Phi\Lambda' + \epsilon,$$

:::{style="text-align:center"}
**$X^*$**: æ½œåœ¨å˜é‡  
**&Phi;**: æŒ‡æ ‡é€‰æ‹©  
**&Lambda;**: å•é¡¹è´¡çŒ®ï¼ˆa.k.a., factor loadingï¼‰  
**&epsilon;** é€‰æ‹©è¯¯å·®
:::
:::

:::{.notes}
Quinn, Kevin M. undefined/ed. â€œBayesian Factor Analysis for Mixed Ordinal and Continuous Responses.â€ Political Analysis 12(4): 338â€“53.
:::

:::{.fragment .nonincremental style="text-align:center"}
*æ“ä½œæ­¥éª¤*

1. å› å­ä¸ªæ•°é€‰æ‹©
1. å› å­æå–
1. Rotation
1. å› å­åˆæˆ
1. ç»“æœæ£€éªŒ
:::



## ğŸŒ°ï¼šäººæ ¼æµ‹è¯•

19,719 å‚ä¸è€…, Big5 personality

![](https://drhuyue.site:10002/sammo3182/figure/lv_big5.jpg){fig-align="center" height=400}

## å®è¯æ•°æ®

```{r data-big5, cache=TRUE}
df_big5 <- read_csv("https://drhuyue.site:10002/sammo3182/data/lv_dataBIG5.csv")
df_big5[df_big5 == 0] <- NA
df_big5
```


:::{.notes}
ç»éªŒå¼€æ”¾æ€§Openness, å°½è´£æ€§Conscientiousness, å¤–å‘å‹Extraversion, äº²å’Œæ€§Agreeableness, æƒ…ç»ªä¸ç¨³å®šå‹Neuroticism

https://quantdev.ssri.psu.edu/tutorials/intro-basic-exploratory-factor-analysis
:::

:::{.fragment .nonincremental style="text-align:center"}
*æŒ‘æˆ˜ï¼ˆagainï¼‰*

- é™åˆ°å‡ ç»´
- å¦‚ä½•é™ç»´
:::


## ç»´åº¦é€‰æ‹©æ–¹æ³•ï¼šç›¸å…³æ€§åˆ†æ

```{r corrplot, fig.align='center', fig.height=6}
df_big5 %>%
  select(8:57) %>%
  cor(use = "complete.obs") %>%
  corrplot(order = "hclust",
           tl.col = 'black',
           tl.cex = .75) 
```



## ç»´åº¦é€‰æ‹©æ–¹æ³•ï¼šHorn's Parallel Analysis

:::: {.columns}

::: {.column width="70%"}
```{r parallelAnalysis, fig.align='center', fig.height=6, results='hide'}
df_big5 %>%
  select(8:57) %>%
  fa.parallel(fa = "fa")
```
:::

::: {.column width="30%"}
å·²çŸ¥è§‚æµ‹æ•°æ®é›†**O**<sub>m&times;n</sub>

1. åˆ›å»ºéšæœºæ•°æ®é›†**R**<sub>m&times;n</sub>;  
1. ç›¸å…³çŸ©é˜µ<sub>**R**</sub> &rarr; &lambda;<sub>**R**</sub>;  
1. ç›¸å…³çŸ©é˜µ<sub>**Ok**</sub> &rarr; &lambda;<sub>**Ok**</sub> (kä¸ºå› å­æ•°)
1. &lambda;<sub>**Ok**</sub> vs. &lambda;<sub>**R**</sub>

:::{.fragment}
A. å¦‚æœ&lambda;<sub>**Ok**</sub> < &lambda;<sub>**R**</sub>, åˆ™ ~~k~~
B. Kaiser criterion
:::

:::

::::



## å› å­æå–(Factor Extraction)

+ Minimum residual (OLS)
+ Principal axes
+ Alpha factoring
+ Weighted least squares
+ Minimum rank
+ [Maximum likelihood (ML, minimum &chi;<sup>2</sup> goodness of fit)]{.red}


## Rotation: æ•ˆæœä¼˜åŒ–

![](https://drhuyue.site:10002/sammo3182/figure/lv_rotation.jpg){fig-align="center" height=400}   

:::{.notes}
Rotation:

A pattern of loadings where each item loads strongly on only one of the factors, and much more weakly on the other factors.
:::

* Orthogonal: Varimax, quartimax, bentlerT, geominT, bifactor  
* [Oblique]{.red}: Oblimin, quartimin, simplimax, bentlerQ, geominQ, biquartimin


:::{.notes}
Orthogonal(æ­£äº¤)

ä¼˜é€‰Obliqueï¼Œå…è®¸factoré—´correlate
:::


## åˆæˆç»“æœ

:::: {.columns}

::: {.column width="50%"}

ML + Oblimin

```{r efa, eval = TRUE}
result_efa <- df_big5 %>%
  select(8:57) %>%
  fa(nfactors = 5,
     rotate = "oblimin",
     fm = "ml")

print(result_efa$loadings, cutoff = .296) # the point was picked for the purpose of presentation
```
:::

::: {.column width="50%"}
```{r scores, fig.align='center', fig.height=8}
# Reshape the data to a long format
df_scores_long <- as.data.frame(result_efa$scores) |>
  pivot_longer(cols = everything(), 
               names_to = "Factor", 
               values_to = "Score")

# Create the histograms using ggplot2 and facet by factor
ggplot(df_scores_long, aes(x = Score)) +
  geom_histogram(binwidth = 0.5) +  # Adjust binwidth as needed
  facet_wrap(~ Factor, scales = "free_y", ncol = 1) +  # Facet into 1 column, adjust y scales independently
  labs(x = "Score", y = "Frequency", title = "Histograms of EFA Factors")  # Adjust labels as necessary
```
:::

::::


## è¯Šæ–­æŒ‡æ ‡

1. Sum of squared (SS) loading^[ç‰¹å¾å€¼]: 1
1. Communality/Uniqueness
1. Root means square of residuals(RMSR): 0.05
1. Tucker-Lewis Indes (TLI): 0.9
1. Reliability test (Crobach's &alpha;)^[ä¸ºæ¯ä¸ªå› å­åˆ†åˆ«è®¡ç®—]

:::{.notes}
SSï¼šKaiser criterion: &lambda; < 1 ä¸å¯
Communality:  SS of all the factor loadings for a given variable
Uniqueness: 1 - Communality
RMSR < 0.05
TLI > 0.9

Crobach's &alpha;: è®¡ç®—å› å­åˆ†å¸ƒçš„variablesæ˜¯ä¸æ˜¯å†…éƒ¨ä¸€è‡´ï¼Œé™¤éå‘è¡¨ï¼Œä¸å¤§å¿…è¦
:::

---

```{r efa-full}
summary(result_efa)
```

## æ³¨æ„äº‹é¡¹

- EFAæ˜¯*å½’çº³å¼*ç ”ç©¶æ–¹æ³•ï¼Œ[å¹¶éç»Ÿè®¡æ¨æ–­]{.red}
- EFAåº”ç”¨éœ€æ»¡è¶³ä»¥ä¸‹å‡å®š:
    1. [*Linearity*]{.red} between the observed and latent
    1. [*Sufficient correlation*]{.red} between the observed and latent
    1. [*Homoscedasticity*]{.red}
    1. [*Multivariate normality*]{.red} among the observed
    1. [*No singularity*]{.blue} among the observed
    1. [*Large N*]{.blue}: 10 ~ 300
    1. [*Factorial Simplicity*]{.blue}
- EFAä¸æ˜¯å”¯ä¸€åˆç†çš„åˆå¹¶æ–¹å¼
    - [IRT]{.gray}
    - PCA


:::{.notes}
Red: bias; blue: efficiency

1. **Linearity**: EFA assumes a linear relationship between observed variables and underlying factors. This means that changes in the levels of factors are associated with proportional changes in the observed variables.

2. **Multivariate Normality**: Ideally, the observed variables should follow a multivariate normal distribution. While EFA can be performed on data that do not perfectly adhere to this assumption, deviations from multivariate normality can affect the robustness of the factor analysis, especially when estimating parameters and computing fit indices.

3. **Adequate Sample Size**: There is no strict rule for the minimum sample size in EFA, but a larger sample size can provide more reliable and stable factor solutions. A commonly cited guideline suggests having at least 5 to 10 observations per variable, though some scholars recommend a minimum of 300 cases as a more general benchmark.

4. **No Perfect Multicollinearity or Singularity**: While EFA aims to identify the underlying structure by exploring the correlations between variables, perfect multicollinearity (where one variable is a perfect linear combination of others) should be avoided. Similarly, singularity (where some variables are redundant) should be avoided, as these conditions can distort the analysis.

5. **Sufficient Correlation**: For a factor model to be meaningful, there must be some degree of correlation among the observed variables. If variables are completely uncorrelated, there would be no underlying factors to extract. The Kaiser-Meyer-Olkin (KMO) measure of sampling adequacy and Bartlett's test of sphericity are commonly used to assess this assumption.

6. **Homoscedasticity**: The assumption of homoscedasticity (equal variances) among variables is also important for the generalizability of EFA results. Significant heteroscedasticity can lead to biased estimates of factor loadings and uniqueness.

7. **Factorial Simplicity**: This is more of a desired property than a strict assumption. Factorial simplicity implies that each variable should load strongly on one factor and have minimal loadings on other factors. This assumption facilitates the interpretability of factors.

Violations of these assumptions can lead to inaccurate factor solutions, misleading interpretations, and conclusions. It is therefore important to assess these assumptions before proceeding with EFA. In practice, some of these assumptions can be relaxed or addressed through data transformation, adopting robust estimation methods, or increasing the sample size.
:::

## Principal Component Analysis

:::{.callout-important}
## æ ¹æœ¬å…¬å¼

$$C = w_iY_i,$$

:::{style="text-align:center"}
**C**: Componentsï¼Œ â€œå› å­â€

**Y**: Measures
:::

:::

![](https://drhuyue.site:10002/sammo3182/figure/lv_pca.png){fig-align="center" height=300}


:::{.notes}
create one or more index variables (Components) from a larger set of measured variables (Y)
:::

## PCA vs. EFA

![](https://drhuyue.site:10002/sammo3182/figure/lv_pcaVsEfa.PNG){fig-align="center" height=500}


::: {.fragment .r-fit-text}
ç»“æœæˆ–è¿‘ä¼¼ï¼Œé€»è¾‘å¤§ä¸åŒ
:::


:::{.notes}
PCA: measurement to index   

write all variables in terms of a smaller set of features which allows for a maximum amount of variance to be retained in the data.   


EFA: indices to measurement (of a latent variable)   

find a set of features which allow for understanding as much of the correlations between measured variables as possible. individually.
:::



## When to usd what

* PCAæœ€å¤§ç¨‹åº¦ä¿ç•™å¯è§å˜é‡ä¿¡æ¯ï¼ŒEFAæ—¨åœ¨æå–ä¸å¯å˜é‡ç‰¹å¾ï¼›
* å½“Variableä¹‹é—´å…³ç³»ä¸é‚£ä¹ˆç´§å¯†æˆ–å—åŒä¸€å˜é‡å½±å“ï¼ŒPCA > EFAï¼›
* å½“ä¼°è®¡æ½œåœ¨å˜é‡æ—¶ï¼ŒPCAå¯èƒ½å¤¸å¤§å¯è§æŒ‡æ ‡çš„å½±å“



# éªŒè¯æ€§å› å­åˆ†æ

## æ¢ç´¢æ€§ vs éªŒè¯æ€§

:::: {.columns}

::: {.column width="50%"}
**EFA: æ•°æ®æŒ‡å‘**

1. å®è¯è§‚å¯Ÿï¼ˆå½’çº³ï¼‰
    - *æ— æ³•ç»Ÿè®¡æ¨æ–­*
1. æœªçŸ¥ç»´åº¦
    + æ¯ä¸ªç»´åº¦éƒ½äº§ç”Ÿå½±å“
1. å¤šé‡æŒ‡æ ‡
    + Loading**å¤§å°**ä¹‹åˆ†
1. æ— è§†æµ‹é‡åå·®å…³è”
1. Underidentified
:::

::: {.column width="50%"}
**CFA: ç†è®ºæŒ‡å‘**

1. ç†è®ºå®šä¹‰ï¼ˆæ¼”ç»ï¼‰
    - [*ä¸“ä¸ºç»Ÿè®¡æ¨æ–­*]{.red}
1. æ˜ç¡®ç»´åº¦
    + ç»´åº¦-æŒ‡æ ‡å…³ç³»æ˜ç¡®
1. å•ä¸€æŒ‡æ ‡
    + Loading[æœ‰æ— ]{.red}ä¹‹åˆ†
1. å…è®¸æµ‹é‡è¯¯å·®ç›¸å…³
1. å¿…é¡»identifiable
:::

::::


## CFAæŒ‡æ ‡é€‰æ‹©

:::: {.columns}

::: {.column width="50%"}

1. ä¸¥æ ¼ä¾æ®ç†è®ºï¼š~~åŸå› ~~æ•ˆæœæŒ‡æ ‡
1. æ¯ç»´åº¦ä¸€æŒ‡æ ‡^[ä½†ç»´åº¦æ‹†åˆ†ï¼Œ[è‰ºæœ¯>æŠ€æœ¯]{.red}.]

:::{.fragment}
ğŸŒ° äººé™…ä¿¡ä»»: [ç›¸ä¿¡]{.red}ä»–äººä¸ä¼š[ä¼¤å®³è‡ªå·±]{.red}æˆ–[è¿èƒŒçº¦å®š]{.red}.

```{r cfa, eval=FALSE}
DiagrammeR::grViz(
  "digraph {

graph[layout = dot]

node[shape = rectangle, style = filled, fillcolor = Linen]

s [label = 'Interpersonal Trust', shape = 'ellipse']
d [label = 'General Trust']
j [label = 'Altruism']
i [label = 'Credibility']

# edge definitions with the node IDs
s -> {d, j, i}
}"
)
```

![](https://drhuyue.site:10002/sammo3182/figure/lv_interTrust.png){fig-align="center" height=300}
:::

:::

::: {.column .fragment .nonincremental width="50%"}
æŒ‡æ ‡ï¼š

1. æ€»ä½“è€Œè¨€ï¼Œæ‚¨æ˜¯è®¤åŒå¤šæ•°äººæ˜¯å€¼å¾—ä¿¡ä»»çš„ï¼Œè¿˜æ˜¯é˜²äººä¹‹å¿ƒä¸å¯æ— ï¼Ÿ
1. æ‚¨è®¤ä¸ºå¤šæ•°æ—¶å€™äººä»¬æ˜¯ä¹äºåŠ©äººçš„è¿˜æ˜¯è‡ªç§è‡ªåˆ©çš„ï¼Ÿ
1. å¦‚æœæœ‰æœºä¼šï¼Œæ‚¨è®¤ä¸ºåˆ«äººæ˜¯ä¼šå æ‚¨ä¾¿å®œï¼Œè¿˜æ˜¯è¯´ä¼šæªå®ˆçº¦å®šã€å…¬å¹³è¡Œäº‹ï¼Ÿ
:::

::::



## å¦ä¸€ä¸ªğŸŒ°ï¼šè¿åŠ¨å‘˜è¯„ä»·

![](https://drhuyue.site:10002/sammo3182/figure/lv_multitrait.png){fig-align="center" height=600}

:::{.notes}
è£åˆ¤å¯¹æ»‘é›ªè¿åŠ¨å‘˜çš„è¯„åˆ¤

å•ä¾§: factor complexity = 1 ï¼ˆä¸€ä¸ªå˜é‡åªè´¡çŒ®ä¸€ä¸ªlatentï¼‰  
åŒä¾§: factor complexity > 1
:::

## å®šä¹‰å…¬å¼

:::: {.columns}

::: {.column width="40%"}
:::{.callout-important}

$$
\begin{align}
X^* =& \Phi\Lambda' + \epsilon; \\
X =& \Lambda X_\xi + \epsilon,
\end{align}
$$

:::{style="text-align:center"}
**X**ï¼š æŒ‡æ ‡å‘é‡  
**&xi;**ï¼šæ½œåœ¨å˜é‡  
**&Lambda;<sub>X</sub>**: X = f(&xi;)ç³»æ•°(a.k.a., loading, path)  
**&epsilon;**ï¼šåè¯¯å‘é‡  

**&Phi;**: æ½œåœ¨å˜é‡çš„åæ–¹å·®çŸ©é˜µ  
**&Theta;<sub>&epsilon;</sub>**: åè¯¯çš„åæ–¹å·®çŸ©é˜µ
:::

:::


:::{.notes}
**&xi;**: ksi  
**&delta;**: delta  
**&Phi;**: phi  
**&Theta;<sub>&sigma;</sub>**: theta  

åœ¨EFAä¸­æ½œåœ¨å˜é‡åœ¨ç­‰å·å·¦è¾¹ï¼Œè§‚æµ‹å˜é‡åœ¨å³è¾¹
:::
:::

::: {.column .fragment width="60%"}
![](https://drhuyue.site:10002/sammo3182/figure/lv_partMultitrait.png){ fig-align="center" height=600}
:::

::::


## ä¼°ç®—

[æµ‹é‡çŸ©é˜µ]{.red}

$$
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
x_4\\
x_5
\end{bmatrix} = 
\begin{bmatrix}
1 & 1 & 0\\
\lambda_{21} & 1 & 0\\
\lambda_{31} & 1 & 0\\
\lambda_{41} & 0 & 1\\
\lambda_{51} & 0 & 1
\end{bmatrix} \begin{bmatrix}\xi_1\\
\xi_2\\
\xi_3
\end{bmatrix} + \begin{bmatrix}\epsilon_1\\
\epsilon_2\\
\epsilon_3\\
\epsilon_4\\
\epsilon_5
\end{bmatrix}
$$

:::: {.columns}

::: {.column width="35%"}
[æ½œå˜é‡çŸ©é˜µ]{.navy}

$$\Phi = \begin{bmatrix}
\phi_{11} & & \\
0 & \phi_{22} & \\
0 & \phi_{23} & \phi_{33}
\end{bmatrix}$$

:::{.notes}
&phi;23$: classical å’Œshowy è£åˆ¤çš„ç›¸å…³æ€§
:::
:::

::: {.column width="65%"}
[åè¯¯çŸ©é˜µ]{.green}

diag **&Theta;<sub>&sigma;</sub>** = diag[var(&epsilon;<sub>1</sub>) var(&epsilon;<sub>2</sub>)...var(&epsilon;<sub>5</sub>)]
:::

::::


:::{.fragment}
ä¼¼æ›¾ç›¸è¯†ï¼Ÿ
:::



## Identification

a.k.a., æœ€å¤šèƒ½è¿å¤šå°‘çº¿ï¼Ÿ

:::: {.columns}

::: {.column width="50%"}
Identified: å½“**&Lambda;ã€&Phi;ã€&Theta;**å­˜åœ¨å”¯ä¸€è§£

**&Lambda;**: $X = f(\xi)$ç³»æ•° (a.k.a., loading)ï¼›    
**&Phi;**: æ½œåœ¨å˜é‡çš„åæ–¹å·®çŸ©é˜µï¼›   
**&Theta;**: åè¯¯çš„åæ–¹å·®çŸ©é˜µã€‚


:::{.fragment}
**t rule**:

t < q(q + 1)/2

t: ä¸å¯è§   
qï¼šå¯è§
:::


:::{.notes}
Another way to calculate df.
:::

:::

::: {.column width="50%"}
ä¸ºä¿è¯identifableè¿›è¡Œçš„é™åˆ¶

1. Scaling
    + &lambda;<sub>11</sub> = 1;
    + å°†æ½œåœ¨å˜é‡æ–¹å·®è®¾ä¸º1(Standardized metric)
2. å‚æ•°è°ƒæ•´
    + ç‰¹å®šå› å­loadingè®¾ä¸º0ï¼›
    + åè¯¯çš„åæ–¹å·®è®¾ä¸º0ï¼›
    + åè¯¯çš„æ–¹å·®è®¾ä¸º0ï¼›
:::

::::


## æœ€ä¼˜è§£

$$\Sigma(\theta) = \Lambda_X\Phi\Lambda_X' + \Theta_\epsilon,$$
**&Sigma;**: æ‰€æœ‰å¯è§æŒ‡æ ‡å¾—åæ–¹å·®çŸ©é˜µ

:::{.notes}
å¯»æ‰¾æœ€ä¼˜**&Sigma;**
:::

:::: {.columns}

::: {.column .fragment .nonincremental width="50%"}
å…¨ä¿¡æ¯ä¼°è®¡ (Maximum likelihood)

- Generalized Least Squares  
- Unweighted Least Squares
:::

::: {.column .fragment .nonincremental width="50%"}
æœ‰é™ä¿¡æ¯ä¼°è®¡

- Two Stage Least Squares
:::

::::


## å¸¸è§é—®é¢˜

:::: {.columns}

::: {.column width="35%"}
`é”™è¯¯ï¼šå¾…åˆ†æçš„çŸ©é˜µä¸æ˜¯æ­£å®šçš„`

+ æ•°æ®æˆ–åæ–¹å·®çŸ©é˜µä¸­å½•å…¥é”™è¯¯
+ ç¼ºå¤±æ•°æ®
+ å®Œå…¨å…±çº¿æ€§
+ å¼‚å¸¸å€¼
:::

::: {.column width="35%"}
`é”™è¯¯ï¼šä¸æ°å½“çš„è§£`

+ å½•å…¥é”™è¯¯
+ æ€»ä½“è‡³æ¥è¿‘å˜é‡è¾¹ç•Œï¼ŒåŠ ä¹‹æŠ½æ ·æ³¢åŠ¨
+ æ¨¡å‹é”™è¯¯
+ å› ç´ æŒ‡æ ‡è§‚æµ‹é‡è¿‡å°ï¼ˆ<150å·¦å³ï¼‰ä¸”åªæœ‰2æŒ‡æ ‡
+ â€œUnluckyâ€æ ·æœ¬
+ å¼‚å¸¸å€¼
:::

::: {.column width="30%"}
`é”™è¯¯ï¼šæœªæ”¶æ•›`

+ å½•å…¥é”™è¯¯
+ Unidentifiable
+ æ¨¡å‹ä¸ä½³
+ èµ·å§‹å€¼ä¸ä½³
+ å°æ ·æœ¬ï¼ˆN<100ï¼‰
+ æ¯ä¸ªå› ç´ åªæœ‰2æŒ‡æ ‡
+ å¼‚å¸¸å€¼
+ è§‚æµ‹å˜é‡é‡çº²æå¤§å·®å¼‚
:::

::::

:::{.notes}
`Error: Matrix to be analyzed not positive definite`

+ Typo in data file or covariance matrix
+ Pairwise deletion of missing data
+ Perfect collinearity
+ Outliers/influential cases


`Error: Improper solutions`

+ Typo in program
+ Population value near the borderline combined with sampling fluctuation
+ Specification error
+ Small samples (<150 or so) combined with 2 indicators per factor
+ â€œunluckyâ€ sample
+ Outliers/influential cases


`Error: Nonconvergence`

+ Typo in program, data file, or covariance matrix
+ Underidentified model
+ Poor model specification
+ Bad starting values
+ Small samples (N<100)
+ Only 2 indicators per factor
+ Outliers/influential cases
+ Observed variables in very different scale
:::



## è¯Šæ–­

*Overall: &chi;<sup>2</sup>*ï¼Œç»“æœ[æ˜¾è‘—]{.red}åˆ™è¯´æ˜æ•´ä½“æ¨¡å‹å¯èƒ½[æœ‰é—®é¢˜]{.red}ã€‚^[ç„¶è€Œï¼Œå½“Nè¶³å¤Ÿå¤§æ—¶&chi;<sup>2</sup>é€šå¸¸æ˜¾è‘—ã€‚]

:::{.notes}
1. Because models are almost always incorrect, any otherwise reasonably fitting model can be rejected when sample size is sufficient
1. Also a poor fitting model could be accepted if there is insufficient power to detect misspecification.
:::


:::{.fragment .nonincremental}

*Incremental Fit Indices*ï¼šå°†æ¨¡å‹ä¸åŸºçº¿æ¨¡å‹æ¯”è¾ƒ

1. Tucker-Lewis Index (TLI, &rho;<sub>2</sub>, Non-Normed Fit Index)
1. Comparative Fit Index (CFI)

:::

:::{.notes}
åŸºçº¿æ¨¡å‹ï¼šåªä¿ç•™å¯è§å˜é‡çš„æ–¹å·®å’Œåæ–¹å·®

1 ç†æƒ³æƒ…å†µ    
<.95 ä¸å¯æ¥å—

CFIå¯ä»¥>1, è¿™ç§æƒ…å†µè§†ä¸º1
:::


:::{.fragment .nonincremental}
*Absolute Fit Indices*

1. Root Mean Square Error of Approximation (RMSEA)
1. Standardized Root Mean Square Residual (SRMR)
:::

:::{.notes}
+ 0 ç†æƒ³æƒ…å†µ
+ &le; 0.05 ä¸é”™
+ 0.05 ~ 0.08 å·®å¼ºäººæ„
+ &ge; 0.1 ä¸å¯æ¥å—
:::



## ğŸŒ° Holzinger & Swineford 1939


å¯¹åˆä¸­ç”Ÿç²¾ç¥çŠ¶å†µçš„è°ƒæŸ¥ï¼š è§†è§‰å› ç´ ï¼ˆx<sub>1~3</sub>ï¼‰ + é˜…è¯»å› ç´ ï¼ˆx<sub>4~6</sub>ï¼‰+ ï¼ˆè¡¨è¾¾å› ç´ ï¼šx<sub>7~9</sub>ï¼‰

```{r diagram-cfa, fig.align='center'}
HS.model <- ' visual  =~ x1 + x2 + x3
              textual =~ x4 + x5 + x6
              speed   =~ x7 + x8 + x9 '
fit <- cfa(HS.model, data = HolzingerSwineford1939)


semPaths(
  fit,
  layout = "tree",
  curve = 1,
  rotation = 4,
  nCharNodes = 0,
  mar = c(3, 20, 3, 20),
  border.width = 1.0,
  esize = 1.0,
  edge.color = "black",
  label.scale = FALSE,
  label.cex = 1.0,
  residuals = FALSE,
  fixedStyle = 1,
  freeStyle = 1,
  curvePivot = FALSE,
  sizeMan = 7,
  sizeLat = 10
)
```

## ä¼°æµ‹ç»“æœä¸è¯Šæ–­

```{r results-hsModel}
fit <- cfa(HS.model, data = HolzingerSwineford1939)

summary(fit, fit.measures = TRUE)
```


## ç»“æ„æ–¹ç¨‹æ¨¡å‹

:::: {.columns}

::: {.column .nonincremental width="50%"}
- Structural equation model (SEM)   
- LISREL (Linear Structural ReLationships) models   
- Covariance structure models   
- Latent variable models    
- Structural equations with latent variables    

![](https://drhuyue.site:10002/sammo3182/figure/lv_sem.png){.fragment fig-align="center" height=200}
:::

::: {.column .fragment .nonincremental width="50%"}
- Confirmative factor analysis  
- Multiple regression  
- Multivariate regression  
- ANOVA  
- General linear model  
- Path analysis  
- Recursive models  
- Dichotomous and ordered probit  
- Seemingly unrelated regressions  
- Simultaneous models  
- Latent growth curve models  
......
:::

::::


## SEM (in terms of CFA)

:::: {.columns}

::: {.column width="50%"}
**ç»“æ„**

+ è§‚å¯Ÿå˜é‡ï¼š X + Y
+ æ¨¡å‹å»ºæ„ï¼š
    1. Latent variable model
    1. Measurement model (CFA)
    1. Relations among the errors 
+ ä¾ç„¶è¦æ±‚identification

**ä¼°è®¡**ï¼šMLE
:::

::: {.column width="50%"}
**è¯Šæ–­** (å®Œå…¨ä¸€æ ·)

+ Overallï¼š&chi;<sup>2</sup>
+ Incrementalï¼š
    + TLI & CLI
    + Incremental Fit Index(IFI, &Delta;<sup>2</sup>)
+ Absolute:
    + RMSEA
    + BIC
:::

::::

:::{.fragment}
:::{.callout-tip}
## SEMè¿›é˜¶

*æ•¬è¯·æ³¨æ„*ï¼š[SEMç»“æœä»è¡¨ç°ç›¸å…³å…³ç³»ã€‚]{.red}

å¤„ç†Measurement errorsï¼›å¤„ç†éçº¿æ€§å˜é‡(hint: GSEM)ï¼›çº³å…¥å¤šå±‚æ•ˆåº”ï¼›å¤„ç†ç¼ºå¤±å€¼

:::
:::



## ğŸŒ° Bollen 1989

æ”¿æ²»æ°‘ä¸»ï¼ˆ1960ï¼Œ1965ï¼‰ä¸å·¥ä¸šåŒ–

```{r diagram-sem, fig.align='center', fig.height=4, fig.keep="last"}
model <- '
  # measurement model
    ind60 =~ x1 + x2 + x3
    dem60 =~ y1 + y2 + y3 + y4
    dem65 =~ y5 + y6 + y7 + y8
  # regressions
    dem60 ~ ind60
    dem65 ~ ind60 + dem60
  # residual correlations
    y1 ~~ y5
    y2 ~~ y4 + y6
    y3 ~~ y7
    y4 ~~ y8
    y6 ~~ y8
'
fit <- sem(model, data = PoliticalDemocracy)
Graph <- semPaths(
  fit,
  #layout=L,
  layout = "tree2",
  nCharNodes = 0,
  curve = 1,
  rotation = 4,
  #mar=c(3,3,3,3),
  edge.color = "black",
  border.width = 1.0,
  esize = 1.0,
  label.scale = FALSE,
  label.cex = 1.0,
  residuals = FALSE,
  fixedStyle = 1,
  freeStyle = 1,
  curvePivot = FALSE,
  #style="LISREL",
  exoVar = FALSE,
  sizeMan = 7,
  sizeLat = 10,
  DoNotPlot = FALSE
)
L <- matrix(
  c(
    0.4 ,
    1 ,
    0.7 ,
    1 ,
    1.0 ,
    1 ,
    -1.0 ,
    1 ,
    -1.0 ,
    0.71 ,
    -1.0 ,
    0.43 ,
    -1.0 ,
    0.14 ,
    -1.0 ,
    -0.14 ,
    -1.0 ,
    -0.43 ,
    -1.0 ,
    -0.71 ,
    -1.0 ,
    -1    ,
    0.7 ,
    0.4 ,
    0.0 ,
    0.4 ,
    0.0 ,
    -0.4
  ),
  14,
  2,
  byrow = TRUE
)
qgraph(Graph, layout = L, arrowAngle = 0.5)
```

## ç»“æœä¸è¯Šæ–­

```{r results-semModel}
fit <- sem(model, data = PoliticalDemocracy)

summary(fit, fit.measures = TRUE)
```


## æ€»ç»“

:::: {.columns}

::: {.column width="50%"}
:::{.fragment .nonincremental}

* æ½œåœ¨å˜é‡åˆ†ææ¦‚è¿°
    + *å› ç´ åˆ†æ*
    + ç±»å‹åˆ†æ
    
:::


:::{.fragment .nonincremental}
* EFA
    + æ¢ç´¢æ€§å› å­åˆ†æï¼šé€šè¿‡loadingæ‰¾åˆ°æ½œåœ¨å˜é‡
    + EFAè¯Šæ–­ï¼šKaiser's criterion
    + EFA vs. PCA: ç»“æœç›¸ä¼¼ï¼Œé€»è¾‘ä¸åŒ

:::

:::

::: {.column width="50%"}
:::{.fragment .nonincremental}
* CFA
    + éªŒè¯æ€§å› å­åˆ†æï¼šæ£€éªŒæ½œåœ¨å˜é‡å¯¹äºè§‚å¯ŸæŒ‡æ ‡æ˜¯å¦æœ‰å½±å“
    + CFAè¯Šæ–­ï¼š&chi;<sup>2</sup>, TLI/CFIï¼ŒRMSEA/SRMR

:::


:::{.fragment .nonincremental}
* SEM 
    + Latent + measurement models
    + ä¸èƒ½è¯æ˜å› æœå…³ç³»ï¼
:::
:::

::::

:::{.fragment}
::: {.r-fit-text}
**å¾…è§£ä¹‹é¢˜**ï¼šè§‚æµ‹å˜é‡ä¸æ½œå˜é‡ä¹‹é—´å…³ç³»è¦æ˜¯[éçº¿æ€§]{.red}çš„å‘¢ï¼Ÿ
:::

:::

